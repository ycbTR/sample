/*
* Copyright (C) 2009 Joel Sutherland
* Licenced under the MIT license
* http://www.newmediacampaigns.com/page/jquery-flickr-plugin
*
* Available tags for templates:
* title, link, date_taken, description, published, author, author_id, tags, image*

* ********************************************************
* Further modifications by Rahisi Themes 2014.
  --------------------------------------------------------
  - Added data attributes support
  - Added grid output
  ********************************************************
*/
function getColWidth(t,e,n,i){var o=(n-e*(t-1))/t;return"px"==i?Math.floor(o):+(Math.round(o+"e+2")+"e-2")}!function(t){t.fn.jflickrfeed=function(e,n){e=t.extend(!0,{flickrbase:"http://api.flickr.com/services/feeds/",feedapi:"photos_public.gne",limit:20,qstrings:{lang:"en-us",format:"json",jsoncallback:"?"},cleanDescription:!0,useTemplate:!0,itemTemplate:"",itemCallback:function(){}},e);var i,o=t(this).attr("data-userid"),r=t(this).attr("data-limit"),s=t(this).attr("data-cols"),a=t(this).attr("data-margin");if(isNaN(r)||(e.limit=parseInt(r)),o&&(e.qstrings.id=o),!isNaN(s)){cols=parseInt(s);var l,c,u="";i=new Object,-1!=a.indexOf("%")?(l=100,c=a.length-1,u="%",i.margin=parseInt(a.substring(0,c)),i.marginString=i.margin+u,i.width=getColWidth(cols,i.margin,l,u),i.widthString=i.width+u):-1!=a.indexOf("px")?(l=t(this).parent().width(),c=a.length-2,u="px",i.margin=parseInt(a.substring(0,c)),i.marginString=i.margin+u,i.width=getColWidth(cols,i.margin,l,u),i.widthString=i.width+u):(l=100,u="%",i.margin=parseInt(a),i.marginString=i.margin+u,i.width=getColWidth(cols,i.margin,l,u),i.widthString=i.width+u);var d=".flickr-grid { display:block; list-style:none; padding:0; margin: 0;}";d+=".flickr-grid > li { display:block; float: left} ",d+=".flickr-grid > li img { width:100%; height:auto; line-height:1; display:block} ",t("<style>").prop("type","text/css").html(d).appendTo("head"),t(this).addClass("flickr-grid"),i.style="width:"+i.widthString+"; margin:0 "+i.marginString+" "+i.marginString+" 0; }",i.lastStyle="width:"+i.widthString+"; margin:0 0 "+i.marginString+" 0; }"}var p=e.flickrbase+e.feedapi+"?",h=!0;for(var f in e.qstrings)h||(p+="&"),p+=f+"="+e.qstrings[f],h=!1;return t(this).each(function(){var o=t(this),r=this;t.getJSON(p,function(s){t.each(s.items,function(t,n){if(t<e.limit){if(e.cleanDescription){var s=/<p>(.*?)<\/p>/g,a=n.description;s.test(a)&&(n.description=a.match(s)[2],void 0!=n.description&&(n.description=n.description.replace("<p>","").replace("</p>","")))}if(n.image_s=n.media.m.replace("_m","_s"),n.image_t=n.media.m.replace("_m","_t"),n.image_m=n.media.m.replace("_m","_m"),n.image=n.media.m.replace("_m",""),n.image_b=n.media.m.replace("_m","_b"),delete n.media,e.useTemplate){var l=e.itemTemplate;for(var c in n){var u=new RegExp("{{"+c+"}}","g");l=l.replace(u,n[c])}i&&(l=(t+1)%cols==0?l.replace("item_style",i.lastStyle):l.replace("item_style",i.style)),o.append(l)}e.itemCallback.call(r,n)}}),t.isFunction(n)&&n.call(r,s)})})}}(jQuery);