!function(e){"use strict";function t(t,n){this.itemsArray=[],this.$element=e(t),this.$element.hide(),this.isSelect="SELECT"===t.tagName,this.multiple=this.isSelect&&t.hasAttribute("multiple"),this.objectItems=n&&n.itemValue,this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=e('<div class="bootstrap-tagsinput"></div>'),this.$input=e('<input size="'+this.inputSize+'" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container),this.build(n)}function n(e,t){if("function"!=typeof e[t]){var n=e[t];e[t]=function(e){return e[n]}}}function i(e,t){if("function"!=typeof e[t]){var n=e[t];e[t]=function(){return n}}}function s(e){return e?r.text(e).html():""}function a(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}var o={tagClass:function(){return"label label-primary"},itemValue:function(e){return e?e.toString():e},itemText:function(e){return this.itemValue(e)},freeInput:!0,maxTags:void 0,confirmKeys:[13],onTagExists:function(e,t){t.hide().fadeIn()}};t.prototype={constructor:t,add:function(t,n){var i=this;if(!(i.options.maxTags&&i.itemsArray.length>=i.options.maxTags||t!==!1&&!t)){if("object"==typeof t&&!i.objectItems)throw"Can't add objects when itemValue option is not set";if(!t.toString().match(/^\s*$/)){if(i.isSelect&&!i.multiple&&i.itemsArray.length>0&&i.remove(i.itemsArray[0]),"string"==typeof t&&"INPUT"===this.$element[0].tagName){var a=t.split(",");if(a.length>1){for(var o=0;o<a.length;o++)this.add(a[o],!0);return void(n||i.pushVal())}}var r=i.options.itemValue(t),l=i.options.itemText(t),c=i.options.tagClass(t),u=e.grep(i.itemsArray,function(e){return i.options.itemValue(e)===r})[0];if(u){if(i.options.onTagExists){var d=e(".tag",i.$container).filter(function(){return e(this).data("item")===u});i.options.onTagExists(t,d)}}else{i.itemsArray.push(t);var h=e('<span class="tag '+s(c)+'">'+s(l)+'<span data-role="remove"></span></span>');if(h.data("item",t),i.findInputWrapper().before(h),h.after(" "),i.isSelect&&!e('option[value="'+escape(r)+'"]',i.$element)[0]){var p=e("<option selected>"+s(l)+"</option>");p.data("item",t),p.attr("value",r),i.$element.append(p)}n||i.pushVal(),i.options.maxTags===i.itemsArray.length&&i.$container.addClass("bootstrap-tagsinput-max"),i.$element.trigger(e.Event("itemAdded",{item:t}))}}}},remove:function(t,n){var i=this;i.objectItems&&(t="object"==typeof t?e.grep(i.itemsArray,function(e){return i.options.itemValue(e)==i.options.itemValue(t)})[0]:e.grep(i.itemsArray,function(e){return i.options.itemValue(e)==t})[0]),t&&(e(".tag",i.$container).filter(function(){return e(this).data("item")===t}).remove(),e("option",i.$element).filter(function(){return e(this).data("item")===t}).remove(),i.itemsArray.splice(e.inArray(t,i.itemsArray),1)),n||i.pushVal(),i.options.maxTags>i.itemsArray.length&&i.$container.removeClass("bootstrap-tagsinput-max"),i.$element.trigger(e.Event("itemRemoved",{item:t}))},removeAll:function(){var t=this;for(e(".tag",t.$container).remove(),e("option",t.$element).remove();t.itemsArray.length>0;)t.itemsArray.pop();t.pushVal(),t.options.maxTags&&!this.isEnabled()&&this.enable()},refresh:function(){var t=this;e(".tag",t.$container).each(function(){var n=e(this),i=n.data("item"),a=t.options.itemValue(i),o=t.options.itemText(i),r=t.options.tagClass(i);if(n.attr("class",null),n.addClass("tag "+s(r)),n.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=s(o),t.isSelect){var l=e("option",t.$element).filter(function(){return e(this).data("item")===i});l.attr("value",a)}})},items:function(){return this.itemsArray},pushVal:function(){var t=this,n=e.map(t.items(),function(e){return t.options.itemValue(e).toString()});t.$element.val(n,!0).trigger("change")},build:function(t){var s=this;s.options=e.extend({},o,t);var r=s.options.typeahead||{};s.objectItems&&(s.options.freeInput=!1),n(s.options,"itemValue"),n(s.options,"itemText"),n(s.options,"tagClass"),s.options.source&&(r.source=s.options.source),r.source&&e.fn.typeahead&&(i(r,"source"),s.$input.typeahead({source:function(t,n){function i(e){for(var t=[],i=0;i<e.length;i++){var o=s.options.itemText(e[i]);a[o]=e[i],t.push(o)}n(t)}this.map={};var a=this.map,o=r.source(t);e.isFunction(o.success)?o.success(i):e.when(o).then(i)},updater:function(e){s.add(this.map[e])},matcher:function(e){return-1!==e.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(e){return e.sort()},highlighter:function(e){var t=new RegExp("("+this.query+")","gi");return e.replace(t,"<strong>$1</strong>")}})),s.$container.on("click",e.proxy(function(){s.$input.focus()},s)),s.$container.on("keydown","input",e.proxy(function(t){var n=e(t.target),i=s.findInputWrapper();switch(t.which){case 8:if(0===a(n[0])){var o=i.prev();o&&s.remove(o.data("item"))}break;case 46:if(0===a(n[0])){var r=i.next();r&&s.remove(r.data("item"))}break;case 37:var l=i.prev();0===n.val().length&&l[0]&&(l.before(i),n.focus());break;case 39:var c=i.next();0===n.val().length&&c[0]&&(c.after(i),n.focus());break;default:s.options.freeInput&&e.inArray(t.which,s.options.confirmKeys)>=0&&(s.add(n.val()),n.val(""),t.preventDefault())}n.attr("size",Math.max(this.inputSize,n.val().length))},s)),s.$container.on("click","[data-role=remove]",e.proxy(function(t){s.remove(e(t.target).closest(".tag").data("item"))},s)),s.options.itemValue===o.itemValue&&("INPUT"===s.$element[0].tagName?s.add(s.$element.val()):e("option",s.$element).each(function(){s.add(e(this).attr("value"),!0)}))},destroy:function(){var e=this;e.$container.off("keypress","input"),e.$container.off("click","[role=remove]"),e.$container.remove(),e.$element.removeData("tagsinput"),e.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var t=this.$input[0],n=this.$container[0];t&&t.parentNode!==n;)t=t.parentNode;return e(t)}},e.fn.tagsinput=function(n,i){var s=[];return this.each(function(){var a=e(this).data("tagsinput");if(a){var o=a[n](i);void 0!==o&&s.push(o)}else a=new t(this,n),e(this).data("tagsinput",a),s.push(a),"SELECT"===this.tagName&&e("option",e(this)).attr("selected","selected"),e(this).val(e(this).val())}),"string"==typeof n?s.length>1?s:s[0]:s},e.fn.tagsinput.Constructor=t;var r=e("<div />");e(function(){e("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);