document.observe("click",function(e,t){if(t=e.findElement("form a.add_nested_fields")){var n=t.readAttribute("data-association"),r=t.readAttribute("data-target"),o=$(t.readAttribute("data-blueprint-id")),s=o.readAttribute("data-blueprint"),a=(t.getOffsetParent(".fields").firstDescendant().readAttribute("name")||"").replace(new RegExp("[[a-z_]+]$"),"");if(a){var l=a.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],c=a.match(/[0-9]+/g)||[];for(i=0;i<l.length;i++)c[i]&&(s=s.replace(new RegExp("(_"+l[i]+")_.+?_","g"),"$1_"+c[i]+"_"),s=s.replace(new RegExp("(\\["+l[i]+"\\])\\[.+?\\]","g"),"$1["+c[i]+"]"))}var u=new RegExp("new_"+n,"g"),d=(new Date).getTime();s=s.replace(u,d);var h;return h=r?$$(r)[0].insert(s):t.insert({before:s}),h.fire("nested:fieldAdded",{field:h}),h.fire("nested:fieldAdded:"+n,{field:h}),!1}}),document.observe("click",function(e,t){if(t=e.findElement("form a.remove_nested_fields")){var n=t.previous(0),i=t.readAttribute("data-association");n&&(n.value="1");var r=t.up(".fields").hide();return r.fire("nested:fieldRemoved",{field:r}),r.fire("nested:fieldRemoved:"+i,{field:r}),!1}});