/*
 wysihtml5 v0.3.0
 https://github.com/xing/wysihtml5

 Author: Christopher Blum (https://github.com/tiff)

 Copyright (C) 2012 XING AG
 Licensed under the MIT license (MIT)

 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Copyright 2011, Tim Down
 Licensed under the MIT license.
 Version: 1.2.2
 Build date: 13 November 2011
*/
var wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window.rangy=function(){function t(t,e){var n=typeof t[e];return n==c||!(n!=l||!t[e])||"unknown"==n}function e(t,e){return!(typeof t[e]!=l||!t[e])}function n(t,e){return typeof t[e]!=u}function i(t){return function(e,n){for(var i=n.length;i--;)if(!t(e,n[i]))return!1;return!0}}function r(t){return t&&m(t,p)&&v(t,f)}function o(t){window.alert("Rangy not supported in your browser. Reason: "+t),y.initialized=!0,y.supported=!1}function s(){if(!y.initialized){var n,i=!1,s=!1;for(t(document,"createRange")&&(n=document.createRange(),m(n,h)&&v(n,d)&&(i=!0),n.detach()),(n=e(document,"body")?document.body:document.getElementsByTagName("body")[0])&&t(n,"createTextRange")&&(n=n.createTextRange(),r(n)&&(s=!0)),!i&&!s&&o("Neither Range nor TextRange are implemented"),y.initialized=!0,y.features={implementsDomRange:i,implementsTextRange:s},i=w.concat(b),s=0,n=i.length;n>s;++s)try{i[s](y)}catch(a){e(window,"console")&&t(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",a)}}}function a(t){this.name=t,this.supported=this.initialized=!1}var l="object",c="function",u="undefined",d="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),h="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),f="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),p="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),m=i(t),g=i(e),v=i(n),y={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:e,isHostProperty:n,areHostMethods:m,areHostObjects:g,areHostProperties:v,isTextRange:r},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};y.fail=o,y.warn=function(t){t="Rangy warning: "+t,y.config.alertOnWarn?window.alert(t):typeof window.console!=u&&typeof window.console.log!=u&&window.console.log(t)},{}.hasOwnProperty?y.util.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}:o("hasOwnProperty not supported");var b=[],w=[];y.init=s,y.addInitListener=function(t){y.initialized?t(y):b.push(t)};var x=[];y.addCreateMissingNativeApiListener=function(t){x.push(t)},y.createMissingNativeApi=function(t){t=t||window,s();for(var e=0,n=x.length;n>e;++e)x[e](t)},a.prototype.fail=function(t){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+t)},a.prototype.warn=function(t){y.warn("Module "+this.name+": "+t)},a.prototype.createError=function(t){return Error("Error in Rangy "+this.name+" module: "+t)},y.createModule=function(t,e){var n=new a(t);y.modules[t]=n,w.push(function(t){e(t,n),n.initialized=!0,n.supported=!0})},y.requireModules=function(t){for(var e,n,i=0,r=t.length;r>i;++i){if(n=t[i],e=y.modules[n],!(e&&e instanceof a))throw Error("Module '"+n+"' not found");if(!e.supported)throw Error("Module '"+n+"' not supported")}};var C=!1,g=function(){C||(C=!0,y.initialized||s())};if(typeof window==u)o("No window found");else{if(typeof document!=u)return t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",g,!1),t(window,"addEventListener")?window.addEventListener("load",g,!1):t(window,"attachEvent")?window.attachEvent("onload",g):o("Window does not have required addEventListener or attachEvent method"),y;o("No document found")}}(),rangy.createModule("DomUtil",function(t,e){function n(t){for(var e=0;t=t.previousSibling;)e++;return e}function i(t,e){var n,i=[];for(n=t;n;n=n.parentNode)i.push(n);for(n=e;n;n=n.parentNode)if(m(i,n))return n;return null}function r(t,e,n){for(n=n?t:t.parentNode;n;){if(t=n.parentNode,t===e)return n;n=t}return null}function o(t){return t=t.nodeType,3==t||4==t||8==t}function s(t,e){var n=e.nextSibling,i=e.parentNode;return n?i.insertBefore(t,n):i.appendChild(t),t}function a(t){if(9==t.nodeType)return t;if(typeof t.ownerDocument!=h)return t.ownerDocument;if(typeof t.document!=h)return t.document;if(t.parentNode)return a(t.parentNode);throw Error("getDocument: no document found for node")}function l(t){return t?o(t)?'"'+t.data+'"':1==t.nodeType?"<"+t.nodeName+(t.id?' id="'+t.id+'"':"")+">["+t.childNodes.length+"]":t.nodeName:"[No node]"}function c(t){this._next=this.root=t}function u(t,e){this.node=t,this.offset=e}function d(t){this.code=this[t],this.codeName=t,this.message="DOMException: "+this.codeName}var h="undefined",f=t.util;f.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||e.fail("document missing a Node creation method"),f.isHostMethod(document,"getElementsByTagName")||e.fail("document missing getElementsByTagName method");var p=document.createElement("div");f.areHostMethods(p,["insertBefore","appendChild","cloneNode"])||e.fail("Incomplete Element implementation"),f.isHostProperty(p,"innerHTML")||e.fail("Element is missing innerHTML property"),p=document.createTextNode("test"),f.areHostMethods(p,["splitText","deleteData","insertData","appendData","cloneNode"])||e.fail("Incomplete Text Node implementation");var m=function(t,e){for(var n=t.length;n--;)if(t[n]===e)return!0;return!1};c.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var t,e=this._current=this._next;if(this._current){if(t=e.firstChild,!t)for(t=null;e!==this.root&&!(t=e.nextSibling);)e=e.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},u.prototype={equals:function(t){return this.node===t.node&this.offset==t.offset},inspect:function(){return"[DomPosition("+l(this.node)+":"+this.offset+")]"}},d.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},d.prototype.toString=function(){return this.message},t.dom={arrayContains:m,isHtmlNamespace:function(t){var e;return typeof t.namespaceURI==h||null===(e=t.namespaceURI)||"http://www.w3.org/1999/xhtml"==e},parentElement:function(t){return t=t.parentNode,1==t.nodeType?t:null},getNodeIndex:n,getNodeLength:function(t){var e;return o(t)?t.length:(e=t.childNodes)?e.length:0},getCommonAncestor:i,isAncestorOf:function(t,e,n){for(e=n?e:e.parentNode;e;){if(e===t)return!0;e=e.parentNode}return!1},getClosestAncestorIn:r,isCharacterDataNode:o,insertAfter:s,splitDataNode:function(t,e){var n=t.cloneNode(!1);return n.deleteData(0,e),t.deleteData(e,t.length-e),s(n,t),n},getDocument:a,getWindow:function(t){if(t=a(t),typeof t.defaultView!=h)return t.defaultView;if(typeof t.parentWindow!=h)return t.parentWindow;throw Error("Cannot get a window object for node")},getIframeWindow:function(t){if(typeof t.contentWindow!=h)return t.contentWindow;if(typeof t.contentDocument!=h)return t.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element")},getIframeDocument:function(t){if(typeof t.contentDocument!=h)return t.contentDocument;if(typeof t.contentWindow!=h)return t.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element")},getBody:function(t){return f.isHostObject(t,"body")?t.body:t.getElementsByTagName("body")[0]},getRootContainer:function(t){for(var e;e=t.parentNode;)t=e;return t},comparePoints:function(t,e,o,s){var a;if(t==o)return e===s?0:s>e?-1:1;if(a=r(o,t,!0))return e<=n(a)?-1:1;if(a=r(t,o,!0))return n(a)<s?-1:1;if(e=i(t,o),t=t===e?e:r(t,e,!0),o=o===e?e:r(o,e,!0),t===o)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(e=e.firstChild;e;){if(e===t)return-1;if(e===o)return 1;e=e.nextSibling}throw Error("Should not be here!")},inspectNode:l,fragmentFromNodeChildren:function(t){for(var e,n=a(t).createDocumentFragment();e=t.firstChild;)n.appendChild(e);return n},createIterator:function(t){return new c(t)},DomPosition:u},t.DOMException=d}),rangy.createModule("DomRange",function(t){function e(t,e){return 3!=t.nodeType&&($.isAncestorOf(t,e.startContainer,!0)||$.isAncestorOf(t,e.endContainer,!0))}function n(t){return $.getDocument(t.startContainer)}function i(t,e,n){if(e=t._listeners[e])for(var i=0,r=e.length;r>i;++i)e[i].call(t,{target:t,args:n})}function r(t){return new O(t.parentNode,$.getNodeIndex(t))}function o(t){return new O(t.parentNode,$.getNodeIndex(t)+1)}function s(t,e,n){var i=11==t.nodeType?t.firstChild:t;return $.isCharacterDataNode(e)?n==e.length?$.insertAfter(t,e):e.parentNode.insertBefore(t,0==n?e:$.splitDataNode(e,n)):n>=e.childNodes.length?e.appendChild(t):e.insertBefore(t,e.childNodes[n]),i}function a(t){for(var e,i,r=n(t.range).createDocumentFragment();i=t.next();){if(e=t.isPartiallySelectedSubtree(),i=i.cloneNode(!e),e&&(e=t.getSubtreeIterator(),i.appendChild(a(e)),e.detach(!0)),10==i.nodeType)throw new I("HIERARCHY_REQUEST_ERR");r.appendChild(i)}return r}function l(t,e,n){for(var i,r,n=n||{stop:!1};i=t.next();)if(t.isPartiallySelectedSubtree()){if(!1===e(i)){n.stop=!0;break}if(i=t.getSubtreeIterator(),l(i,e,n),i.detach(!0),n.stop)break}else for(i=$.createIterator(i);r=i.next();)if(!1===e(r))return void(n.stop=!0)}function c(t){for(var e;t.next();)t.isPartiallySelectedSubtree()?(e=t.getSubtreeIterator(),c(e),e.detach(!0)):t.remove()}function u(t){for(var e,i,r=n(t.range).createDocumentFragment();e=t.next();){if(t.isPartiallySelectedSubtree()?(e=e.cloneNode(!1),i=t.getSubtreeIterator(),e.appendChild(u(i)),i.detach(!0)):t.remove(),10==e.nodeType)throw new I("HIERARCHY_REQUEST_ERR");r.appendChild(e)}return r}function d(t,e,n){var i,r=!(!e||!e.length),o=!!n;r&&(i=RegExp("^("+e.join("|")+")$"));var s=[];return l(new f(t,!1),function(t){(!r||i.test(t.nodeType))&&(!o||n(t))&&s.push(t)}),s}function h(t){return"["+("undefined"==typeof t.getName?"Range":t.getName())+"("+$.inspectNode(t.startContainer)+":"+t.startOffset+", "+$.inspectNode(t.endContainer)+":"+t.endOffset+")]"}function f(t,e){if(this.range=t,this.clonePartiallySelectedTextNodes=e,!t.collapsed){this.sc=t.startContainer,this.so=t.startOffset,this.ec=t.endContainer,this.eo=t.endOffset;var n=t.commonAncestorContainer;this.sc===this.ec&&$.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||$.isCharacterDataNode(this.sc)?$.getClosestAncestorIn(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||$.isCharacterDataNode(this.ec)?$.getClosestAncestorIn(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function p(t){this.code=this[t],this.codeName=t,this.message="RangeException: "+this.codeName}function m(t,e,n){this.nodes=d(t,e,n),this._next=this.nodes[0],this._position=0}function g(t){return function(e,n){for(var i,r=n?e:e.parentNode;r;){if(i=r.nodeType,$.arrayContains(t,i))return r;r=r.parentNode}return null}}function v(t,e){if(B(t,e))throw new p("INVALID_NODE_TYPE_ERR")}function y(t){if(!t.startContainer)throw new I("INVALID_STATE_ERR")}function b(t,e){if(!$.arrayContains(e,t.nodeType))throw new p("INVALID_NODE_TYPE_ERR")}function w(t,e){if(0>e||e>($.isCharacterDataNode(t)?t.length:t.childNodes.length))throw new I("INDEX_SIZE_ERR")}function x(t,e){if(F(t,!0)!==F(e,!0))throw new I("WRONG_DOCUMENT_ERR")}function C(t){if(z(t,!0))throw new I("NO_MODIFICATION_ALLOWED_ERR")}function k(t,e){if(!t)throw new I(e)}function T(t){if(y(t),!(($.arrayContains(H,t.startContainer.nodeType)||F(t.startContainer,!0))&&($.arrayContains(H,t.endContainer.nodeType)||F(t.endContainer,!0))&&t.startOffset<=($.isCharacterDataNode(t.startContainer)?t.startContainer.length:t.startContainer.childNodes.length)&&t.endOffset<=($.isCharacterDataNode(t.endContainer)?t.endContainer.length:t.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+t.inspect()+")")}function _(){}function S(t){t.START_TO_START=X,t.START_TO_END=K,t.END_TO_END=Q,t.END_TO_START=G,t.NODE_BEFORE=J,t.NODE_AFTER=Z,t.NODE_BEFORE_AND_AFTER=te,t.NODE_INSIDE=ee}function E(t){S(t),S(t.prototype)}function N(t,e){return function(){T(this);var n=this.startContainer,i=this.startOffset,r=this.commonAncestorContainer,s=new f(this,!0);return n!==r&&(n=$.getClosestAncestorIn(n,r,!0),i=o(n),n=i.node,i=i.offset),l(s,C),s.reset(),r=t(s),s.detach(),e(this,n,i,n,i),r}}function D(n,i,s){function a(t,e){return function(n){y(this),b(n,P),b(W(n),H),n=(t?r:o)(n),(e?l:d)(this,n.node,n.offset)}}function l(t,e,n){var r=t.endContainer,o=t.endOffset;(e!==t.startContainer||n!==t.startOffset)&&((W(e)!=W(r)||1==$.comparePoints(e,n,r,o))&&(r=e,o=n),i(t,e,n,r,o))}function d(t,e,n){var r=t.startContainer,o=t.startOffset;(e!==t.endContainer||n!==t.endOffset)&&((W(e)!=W(r)||-1==$.comparePoints(e,n,r,o))&&(r=e,o=n),i(t,r,o,e,n))}n.prototype=new _,t.util.extend(n.prototype,{setStart:function(t,e){y(this),v(t,!0),w(t,e),l(this,t,e)},setEnd:function(t,e){y(this),v(t,!0),w(t,e),d(this,t,e)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(t){T(this),t?i(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):i(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(t){y(this),v(t,!0),i(this,t,0,t,$.getNodeLength(t))},selectNode:function(t){y(this),v(t,!1),b(t,P);var e=r(t),t=o(t);i(this,e.node,e.offset,t.node,t.offset)},extractContents:N(u,i),deleteContents:N(c,i),canSurroundContents:function(){T(this),C(this.startContainer),C(this.endContainer);var t=new f(this,!0),n=t._first&&e(t._first,this)||t._last&&e(t._last,this);return t.detach(),!n},detach:function(){s(this)},splitBoundaries:function(){T(this);var t=this.startContainer,e=this.startOffset,n=this.endContainer,r=this.endOffset,o=t===n;$.isCharacterDataNode(n)&&r>0&&r<n.length&&$.splitDataNode(n,r),$.isCharacterDataNode(t)&&e>0&&e<t.length&&(t=$.splitDataNode(t,e),o?(r-=e,n=t):n==t.parentNode&&r>=$.getNodeIndex(t)&&r++,e=0),i(this,t,e,n,r)},normalizeBoundaries:function(){T(this);var t=this.startContainer,e=this.startOffset,n=this.endContainer,r=this.endOffset,o=function(t){var e=t.nextSibling;e&&e.nodeType==t.nodeType&&(n=t,r=t.length,t.appendData(e.data),e.parentNode.removeChild(e))},s=function(i){var o=i.previousSibling;if(o&&o.nodeType==i.nodeType){t=i;var s=i.length;e=o.length,i.insertData(0,o.data),o.parentNode.removeChild(o),t==n?(r+=e,n=t):n==i.parentNode&&(o=$.getNodeIndex(i),r==o?(n=i,r=s):r>o&&r--)}},a=!0;$.isCharacterDataNode(n)?n.length==r&&o(n):(r>0&&(a=n.childNodes[r-1])&&$.isCharacterDataNode(a)&&o(a),a=!this.collapsed),a?$.isCharacterDataNode(t)?0==e&&s(t):e<t.childNodes.length&&(o=t.childNodes[e])&&$.isCharacterDataNode(o)&&s(o):(t=n,e=r),i(this,t,e,n,r)},collapseToPoint:function(t,e){y(this),v(t,!0),w(t,e),(t!==this.startContainer||e!==this.startOffset||t!==this.endContainer||e!==this.endOffset)&&i(this,t,e,t,e)}}),E(n)}function M(t){t.collapsed=t.startContainer===t.endContainer&&t.startOffset===t.endOffset,t.commonAncestorContainer=t.collapsed?t.startContainer:$.getCommonAncestor(t.startContainer,t.endContainer)}function A(t,e,n,r,o){var s=t.startContainer!==e||t.startOffset!==n,a=t.endContainer!==r||t.endOffset!==o;t.startContainer=e,t.startOffset=n,t.endContainer=r,t.endOffset=o,M(t),i(t,"boundarychange",{startMoved:s,endMoved:a})}function L(t){this.startContainer=t,this.startOffset=0,this.endContainer=t,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},M(this)}t.requireModules(["DomUtil"]);var $=t.dom,O=$.DomPosition,I=t.DOMException;f.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var t=this._current=this._next;return t&&(this._next=t!==this._last?t.nextSibling:null,$.isCharacterDataNode(t)&&this.clonePartiallySelectedTextNodes&&(t===this.ec&&(t=t.cloneNode(!0)).deleteData(this.eo,t.length-this.eo),this._current===this.sc&&(t=t.cloneNode(!0)).deleteData(0,this.so))),t},remove:function(){var t,e,n=this._current;!$.isCharacterDataNode(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(t=n===this.sc?this.so:0,e=n===this.ec?this.eo:n.length,t!=e&&n.deleteData(t,e-t))},isPartiallySelectedSubtree:function(){return e(this._current,this.range)},getSubtreeIterator:function(){var t;if(this.isSingleCharacterDataNode)t=this.range.cloneRange(),t.collapse();else{t=new L(n(this.range));var e=this._current,i=e,r=0,o=e,s=$.getNodeLength(e);$.isAncestorOf(e,this.sc,!0)&&(i=this.sc,r=this.so),$.isAncestorOf(e,this.ec,!0)&&(o=this.ec,s=this.eo),A(t,i,r,o,s)}return new f(t,this.clonePartiallySelectedTextNodes)},detach:function(t){t&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},p.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},p.prototype.toString=function(){return this.message},m.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var P=[1,3,4,5,7,8,10],H=[2,9,11],R=[1,3,4,5,7,8,10,11],j=[1,3,4,5,7,8],W=$.getRootContainer,F=g([9,11]),z=g([5,6,10,12]),B=g([6,10,12]),q=document.createElement("style"),V=!1;try{q.innerHTML="<b>x</b>",V=3==q.firstChild.nodeType}catch(U){}t.features.htmlParsingConforms=V;var Y="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),X=0,K=1,Q=2,G=3,J=0,Z=1,te=2,ee=3;_.prototype={attachListener:function(t,e){this._listeners[t].push(e)},compareBoundaryPoints:function(t,e){T(this),x(this.startContainer,e.startContainer);var n=t==G||t==X?"start":"end",i=t==K||t==X?"start":"end";return $.comparePoints(this[n+"Container"],this[n+"Offset"],e[i+"Container"],e[i+"Offset"])},insertNode:function(t){if(T(this),b(t,R),C(this.startContainer),$.isAncestorOf(t,this.startContainer,!0))throw new I("HIERARCHY_REQUEST_ERR");this.setStartBefore(s(t,this.startContainer,this.startOffset))},cloneContents:function(){T(this);var t,e;return this.collapsed?n(this).createDocumentFragment():this.startContainer===this.endContainer&&$.isCharacterDataNode(this.startContainer)?(t=this.startContainer.cloneNode(!0),t.data=t.data.slice(this.startOffset,this.endOffset),e=n(this).createDocumentFragment(),e.appendChild(t),e):(e=new f(this,!0),t=a(e),e.detach(),t)},canSurroundContents:function(){T(this),C(this.startContainer),C(this.endContainer);var t=new f(this,!0),n=t._first&&e(t._first,this)||t._last&&e(t._last,this);return t.detach(),!n},surroundContents:function(t){if(b(t,j),!this.canSurroundContents())throw new p("BAD_BOUNDARYPOINTS_ERR");var e=this.extractContents();if(t.hasChildNodes())for(;t.lastChild;)t.removeChild(t.lastChild);s(t,this.startContainer,this.startOffset),t.appendChild(e),this.selectNode(t)},cloneRange:function(){T(this);for(var t,e=new L(n(this)),i=Y.length;i--;)t=Y[i],e[t]=this[t];return e},toString:function(){T(this);var t=this.startContainer;if(t===this.endContainer&&$.isCharacterDataNode(t))return 3==t.nodeType||4==t.nodeType?t.data.slice(this.startOffset,this.endOffset):"";var e=[],t=new f(this,!0);return l(t,function(t){(3==t.nodeType||4==t.nodeType)&&e.push(t.data)}),t.detach(),e.join("")},compareNode:function(t){T(this);var e=t.parentNode,n=$.getNodeIndex(t);if(!e)throw new I("NOT_FOUND_ERR");return t=this.comparePoint(e,n),e=this.comparePoint(e,n+1),0>t?e>0?te:J:e>0?Z:ee},comparePoint:function(t,e){return T(this),k(t,"HIERARCHY_REQUEST_ERR"),x(t,this.startContainer),0>$.comparePoints(t,e,this.startContainer,this.startOffset)?-1:0<$.comparePoints(t,e,this.endContainer,this.endOffset)?1:0},createContextualFragment:V?function(t){var e=this.startContainer,n=$.getDocument(e);if(!e)throw new I("INVALID_STATE_ERR");var i=null;return 1==e.nodeType?i=e:$.isCharacterDataNode(e)&&(i=$.parentElement(e)),i=null===i||"HTML"==i.nodeName&&$.isHtmlNamespace($.getDocument(i).documentElement)&&$.isHtmlNamespace(i)?n.createElement("body"):i.cloneNode(!1),i.innerHTML=t,$.fragmentFromNodeChildren(i)}:function(t){y(this);var e=n(this).createElement("body");return e.innerHTML=t,$.fragmentFromNodeChildren(e)},toHtml:function(){T(this);var t=n(this).createElement("div");return t.appendChild(this.cloneContents()),t.innerHTML},intersectsNode:function(t,e){if(T(this),k(t,"NOT_FOUND_ERR"),$.getDocument(t)!==n(this))return!1;var i=t.parentNode,r=$.getNodeIndex(t);k(i,"NOT_FOUND_ERR");var o=$.comparePoints(i,r,this.endContainer,this.endOffset),i=$.comparePoints(i,r+1,this.startContainer,this.startOffset);return e?0>=o&&i>=0:0>o&&i>0},isPointInRange:function(t,e){return T(this),k(t,"HIERARCHY_REQUEST_ERR"),x(t,this.startContainer),0<=$.comparePoints(t,e,this.startContainer,this.startOffset)&&0>=$.comparePoints(t,e,this.endContainer,this.endOffset)},intersectsRange:function(t,e){if(T(this),n(t)!=n(this))throw new I("WRONG_DOCUMENT_ERR");var i=$.comparePoints(this.startContainer,this.startOffset,t.endContainer,t.endOffset),r=$.comparePoints(this.endContainer,this.endOffset,t.startContainer,t.startOffset);return e?0>=i&&r>=0:0>i&&r>0},intersection:function(t){if(this.intersectsRange(t)){var e=$.comparePoints(this.startContainer,this.startOffset,t.startContainer,t.startOffset),n=$.comparePoints(this.endContainer,this.endOffset,t.endContainer,t.endOffset),i=this.cloneRange();return-1==e&&i.setStart(t.startContainer,t.startOffset),1==n&&i.setEnd(t.endContainer,t.endOffset),i}return null},union:function(t){if(this.intersectsRange(t,!0)){var e=this.cloneRange();return-1==$.comparePoints(t.startContainer,t.startOffset,this.startContainer,this.startOffset)&&e.setStart(t.startContainer,t.startOffset),1==$.comparePoints(t.endContainer,t.endOffset,this.endContainer,this.endOffset)&&e.setEnd(t.endContainer,t.endOffset),e}throw new p("Ranges do not intersect")},containsNode:function(t,e){return e?this.intersectsNode(t,!1):this.compareNode(t)==ee},containsNodeContents:function(t){return 0<=this.comparePoint(t,0)&&0>=this.comparePoint(t,$.getNodeLength(t))},containsRange:function(t){return this.intersection(t).equals(t)},containsNodeText:function(t){var e=this.cloneRange();e.selectNode(t);var n=e.getNodes([3]);return 0<n.length?(e.setStart(n[0],0),t=n.pop(),e.setEnd(t,t.length),t=this.containsRange(e),e.detach(),t):this.containsNodeContents(t)},createNodeIterator:function(t,e){return T(this),new m(this,t,e)},getNodes:function(t,e){return T(this),d(this,t,e)},getDocument:function(){return n(this)},collapseBefore:function(t){y(this),this.setEndBefore(t),this.collapse(!1)},collapseAfter:function(t){y(this),this.setStartAfter(t),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(t){return L.rangesEqual(this,t)},inspect:function(){return h(this)}},D(L,A,function(t){y(t),t.startContainer=t.startOffset=t.endContainer=t.endOffset=null,t.collapsed=t.commonAncestorContainer=null,i(t,"detach",null),t._listeners=null}),t.rangePrototype=_.prototype,L.rangeProperties=Y,L.RangeIterator=f,L.copyComparisonConstants=E,L.createPrototypeRange=D,L.inspect=h,L.getRangeDocument=n,L.rangesEqual=function(t,e){return t.startContainer===e.startContainer&&t.startOffset===e.startOffset&&t.endContainer===e.endContainer&&t.endOffset===e.endOffset},t.DomRange=L,t.RangeException=p}),rangy.createModule("WrappedRange",function(t){function e(t,e,n,i){var s=t.duplicate();s.collapse(n);var a=s.parentElement();if(r.isAncestorOf(e,a,!0)||(a=e),!a.canHaveHTML)return new o(a.parentNode,r.getNodeIndex(a));var l,e=r.getDocument(a).createElement("span"),c=n?"StartToStart":"StartToEnd";do a.insertBefore(e,e.previousSibling),s.moveToElementText(e);while(0<(l=s.compareEndPoints(c,t))&&e.previousSibling);if(c=e.nextSibling,-1==l&&c&&r.isCharacterDataNode(c)){if(s.setEndPoint(n?"EndToStart":"EndToEnd",t),/[\r\n]/.test(c.data))for(a=s.duplicate(),n=a.text.replace(/\r\n/g,"\r").length,n=a.moveStart("character",n);-1==a.compareEndPoints("StartToEnd",a);)n++,a.moveStart("character",1);else n=s.text.length;a=new o(c,n)}else c=(i||!n)&&e.previousSibling,a=(n=(i||n)&&e.nextSibling)&&r.isCharacterDataNode(n)?new o(n,0):c&&r.isCharacterDataNode(c)?new o(c,c.length):new o(a,r.getNodeIndex(e));return e.parentNode.removeChild(e),a}function n(t,e){var n,i,o=t.offset,s=r.getDocument(t.node),a=s.body.createTextRange(),l=r.isCharacterDataNode(t.node);return l?(n=t.node,i=n.parentNode):(n=t.node.childNodes,n=o<n.length?n[o]:null,i=t.node),s=s.createElement("span"),s.innerHTML="&#feff;",n?i.insertBefore(s,n):i.appendChild(s),a.moveToElementText(s),a.collapse(!e),i.removeChild(s),l&&a[e?"moveStart":"moveEnd"]("character",o),a}t.requireModules(["DomUtil","DomRange"]);var i,r=t.dom,o=r.DomPosition,s=t.DomRange;if(!t.features.implementsDomRange||t.features.implementsTextRange&&t.config.preferTextRange){if(t.features.implementsTextRange){i=function(t){this.textRange=t,this.refresh()},i.prototype=new s(document),i.prototype.refresh=function(){var t,n,i=this.textRange;t=i.parentElement();var o=i.duplicate();o.collapse(!0),n=o.parentElement(),o=i.duplicate(),o.collapse(!1),i=o.parentElement(),n=n==i?n:r.getCommonAncestor(n,i),n=n==t?n:r.getCommonAncestor(t,n),0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?n=t=e(this.textRange,n,!0,!0):(t=e(this.textRange,n,!0,!1),n=e(this.textRange,n,!1,!1)),this.setStart(t.node,t.offset),this.setEnd(n.node,n.offset)},s.copyComparisonConstants(i);var a=function(){return this}();"undefined"==typeof a.Range&&(a.Range=i),t.createNativeRange=function(t){return t=t||document,t.body.createTextRange()}}}else(function(){function e(t){for(var e,n=a.length;n--;)e=a[n],t[e]=t.nativeRange[e]}var n,o,a=s.rangeProperties;i=function(t){if(!t)throw Error("Range must be specified");this.nativeRange=t,e(this)},s.createPrototypeRange(i,function(t,e,n,i,r){var o=t.endContainer!==i||t.endOffset!=r;(t.startContainer!==e||t.startOffset!=n||o)&&(t.setEnd(i,r),t.setStart(e,n))},function(t){t.nativeRange.detach(),t.detached=!0;for(var e,n=a.length;n--;)e=a[n],t[e]=null}),n=i.prototype,n.selectNode=function(t){this.nativeRange.selectNode(t),e(this)},n.deleteContents=function(){this.nativeRange.deleteContents(),e(this)},n.extractContents=function(){var t=this.nativeRange.extractContents();return e(this),t},n.cloneContents=function(){return this.nativeRange.cloneContents()},n.surroundContents=function(t){this.nativeRange.surroundContents(t),e(this)},n.collapse=function(t){this.nativeRange.collapse(t),e(this)},n.cloneRange=function(){return new i(this.nativeRange.cloneRange())},n.refresh=function(){e(this)},n.toString=function(){return this.nativeRange.toString()};var l=document.createTextNode("test");r.getBody(document).appendChild(l);var c=document.createRange();c.setStart(l,0),c.setEnd(l,0);try{c.setStart(l,1),n.setStart=function(t,n){this.nativeRange.setStart(t,n),e(this)},n.setEnd=function(t,n){this.nativeRange.setEnd(t,n),e(this)},o=function(t){return function(n){this.nativeRange[t](n),e(this)}}}catch(u){n.setStart=function(t,n){try{this.nativeRange.setStart(t,n)}catch(i){this.nativeRange.setEnd(t,n),this.nativeRange.setStart(t,n)}e(this)},n.setEnd=function(t,n){try{this.nativeRange.setEnd(t,n)}catch(i){this.nativeRange.setStart(t,n),this.nativeRange.setEnd(t,n)}e(this)},o=function(t,n){return function(i){try{this.nativeRange[t](i)}catch(r){this.nativeRange[n](i),this.nativeRange[t](i)}e(this)}}}n.setStartBefore=o("setStartBefore","setEndBefore"),n.setStartAfter=o("setStartAfter","setEndAfter"),n.setEndBefore=o("setEndBefore","setStartBefore"),n.setEndAfter=o("setEndAfter","setStartAfter"),c.selectNodeContents(l),n.selectNodeContents=c.startContainer==l&&c.endContainer==l&&0==c.startOffset&&c.endOffset==l.length?function(t){this.nativeRange.selectNodeContents(t),e(this)}:function(t){this.setStart(t,0),this.setEnd(t,s.getEndOffset(t))},c.selectNodeContents(l),c.setEnd(l,3),o=document.createRange(),o.selectNodeContents(l),o.setEnd(l,4),o.setStart(l,2),n.compareBoundaryPoints=-1==c.compareBoundaryPoints(c.START_TO_END,o)&1==c.compareBoundaryPoints(c.END_TO_START,o)?function(t,e){return e=e.nativeRange||e,t==e.START_TO_END?t=e.END_TO_START:t==e.END_TO_START&&(t=e.START_TO_END),this.nativeRange.compareBoundaryPoints(t,e)}:function(t,e){return this.nativeRange.compareBoundaryPoints(t,e.nativeRange||e)},t.util.isHostMethod(c,"createContextualFragment")&&(n.createContextualFragment=function(t){return this.nativeRange.createContextualFragment(t)}),r.getBody(document).removeChild(l),c.detach(),o.detach()})(),t.createNativeRange=function(t){return t=t||document,t.createRange()};t.features.implementsTextRange&&(i.rangeToTextRange=function(t){if(t.collapsed)return n(new o(t.startContainer,t.startOffset),!0);var e=n(new o(t.startContainer,t.startOffset),!0),i=n(new o(t.endContainer,t.endOffset),!1),t=r.getDocument(t.startContainer).body.createTextRange();return t.setEndPoint("StartToStart",e),t.setEndPoint("EndToEnd",i),t}),i.prototype.getName=function(){return"WrappedRange"},t.WrappedRange=i,t.createRange=function(e){return e=e||document,new i(t.createNativeRange(e))},t.createRangyRange=function(t){return t=t||document,new s(t)},t.createIframeRange=function(e){return t.createRange(r.getIframeDocument(e))},t.createIframeRangyRange=function(e){return t.createRangyRange(r.getIframeDocument(e))},t.addCreateMissingNativeApiListener(function(e){e=e.document,"undefined"==typeof e.createRange&&(e.createRange=function(){return t.createRange(this)}),e=e=null})}),rangy.createModule("WrappedSelection",function(t,e){function n(t){return(t||window).getSelection()}function i(t){return(t||window).document.selection}function r(t,e,n){var i=n?"end":"start",n=n?"start":"end";t.anchorNode=e[i+"Container"],t.anchorOffset=e[i+"Offset"],t.focusNode=e[n+"Container"],t.focusOffset=e[n+"Offset"]}function o(t){t.anchorNode=t.focusNode=null,t.anchorOffset=t.focusOffset=0,t.rangeCount=0,t.isCollapsed=!0,t._ranges.length=0}function s(e){var n;return e instanceof b?(n=e._selectionNativeRange,n||(n=t.createNativeRange(v.getDocument(e.startContainer)),n.setEnd(e.endContainer,e.endOffset),n.setStart(e.startContainer,e.startOffset),e._selectionNativeRange=n,e.attachListener("detach",function(){this._selectionNativeRange=null}))):e instanceof w?n=e.nativeRange:t.features.implementsDomRange&&e instanceof v.getWindow(e.startContainer).Range&&(n=e),n}function a(t){var e,n=t.getNodes();t:if(n.length&&1==n[0].nodeType){e=1;for(var i=n.length;i>e;++e)if(!v.isAncestorOf(n[0],n[e])){e=!1;break t}e=!0}else e=!1;if(!e)throw Error("getSingleElementFromRange: range "+t.inspect()+" did not consist of a single element");return n[0]}function l(t,e){var n=new w(e);t._ranges=[n],r(t,n,!1),t.rangeCount=1,t.isCollapsed=n.collapsed}function c(e){if(e._ranges.length=0,"None"==e.docSelection.type)o(e);else{var n=e.docSelection.createRange();if(n&&"undefined"!=typeof n.text)l(e,n);else{e.rangeCount=n.length;for(var i,s=v.getDocument(n.item(0)),a=0;a<e.rangeCount;++a)i=t.createRange(s),i.selectNode(n.item(a)),e._ranges.push(i);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,r(e,e._ranges[e.rangeCount-1],!1)}}}function u(t,e){for(var n=t.docSelection.createRange(),i=a(e),r=v.getDocument(n.item(0)),r=v.getBody(r).createControlRange(),o=0,s=n.length;s>o;++o)r.add(n.item(o));try{r.add(i)}catch(l){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),c(t)}function d(t,e,n){this.nativeSelection=t,this.docSelection=e,this._ranges=[],this.win=n,this.refresh()}function h(t,e){for(var n,i=v.getDocument(e[0].startContainer),i=v.getBody(i).createControlRange(),r=0;rangeCount>r;++r){n=a(e[r]);try{i.add(n)}catch(o){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),c(t)}function f(t,e){if(t.anchorNode&&v.getDocument(t.anchorNode)!==v.getDocument(e))throw new x("WRONG_DOCUMENT_ERR")}function p(t){var e=[],n=new C(t.anchorNode,t.anchorOffset),i=new C(t.focusNode,t.focusOffset),r="function"==typeof t.getName?t.getName():"Selection";if("undefined"!=typeof t.rangeCount)for(var o=0,s=t.rangeCount;s>o;++o)e[o]=b.inspect(t.getRangeAt(o));return"["+r+"(Ranges: "+e.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}t.requireModules(["DomUtil","DomRange","WrappedRange"]),t.config.checkSelectionRanges=!0;var m,g,v=t.dom,y=t.util,b=t.DomRange,w=t.WrappedRange,x=t.DOMException,C=v.DomPosition,k=t.util.isHostMethod(window,"getSelection"),T=t.util.isHostObject(document,"selection"),_=T&&(!k||t.config.preferTextRange);
_?(m=i,t.isSelectionValid=function(t){var t=(t||window).document,e=t.selection;return"None"!=e.type||v.getDocument(e.createRange().parentElement())==t}):k?(m=n,t.isSelectionValid=function(){return!0}):e.fail("Neither document.selection or window.getSelection() detected."),t.getNativeSelection=m;var k=m(),S=t.createNativeRange(document),E=v.getBody(document),N=y.areHostObjects(k,y.areHostProperties(k,["anchorOffset","focusOffset"]));t.features.selectionHasAnchorAndFocus=N;var D=y.isHostMethod(k,"extend");t.features.selectionHasExtend=D;var M="number"==typeof k.rangeCount;t.features.selectionHasRangeCount=M;var A=!1,L=!0;y.areHostMethods(k,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof k.rangeCount&&t.features.implementsDomRange&&function(){var t=document.createElement("iframe");E.appendChild(t);var e=v.getIframeDocument(t);e.open(),e.write("<html><head></head><body>12</body></html>"),e.close();var n=v.getIframeWindow(t).getSelection(),i=e.documentElement.lastChild.firstChild,e=e.createRange();e.setStart(i,1),e.collapse(!0),n.addRange(e),L=1==n.rangeCount,n.removeAllRanges();var r=e.cloneRange();e.setStart(i,0),r.setEnd(i,2),n.addRange(e),n.addRange(r),A=2==n.rangeCount,e.detach(),r.detach(),E.removeChild(t)}(),t.features.selectionSupportsMultipleRanges=A,t.features.collapsedNonEditableSelectionsSupported=L;var $,O=!1;E&&y.isHostMethod(E,"createControlRange")&&($=E.createControlRange(),y.areHostProperties($,["item","add"])&&(O=!0)),t.features.implementsControlRange=O,g=N?function(t){return t.anchorNode===t.focusNode&&t.anchorOffset===t.focusOffset}:function(t){return t.rangeCount?t.getRangeAt(t.rangeCount-1).collapsed:!1};var I;if(y.isHostMethod(k,"getRangeAt")?I=function(t,e){try{return t.getRangeAt(e)}catch(n){return null}}:N&&(I=function(e){var n=v.getDocument(e.anchorNode),n=t.createRange(n);return n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset),n.collapsed!==this.isCollapsed&&(n.setStart(e.focusNode,e.focusOffset),n.setEnd(e.anchorNode,e.anchorOffset)),n}),t.getSelection=function(t){var t=t||window,e=t._rangySelection,n=m(t),r=T?i(t):null;return e?(e.nativeSelection=n,e.docSelection=r,e.refresh(t)):(e=new d(n,r,t),t._rangySelection=e),e},t.getIframeSelection=function(e){return t.getSelection(v.getIframeWindow(e))},$=d.prototype,!_&&N&&y.areHostMethods(k,["removeAllRanges","addRange"])){$.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),o(this)};var P=function(e,n){var i=b.getRangeDocument(n),i=t.createRange(i);i.collapseToPoint(n.endContainer,n.endOffset),e.nativeSelection.addRange(s(i)),e.nativeSelection.extend(n.startContainer,n.startOffset),e.refresh()};$.addRange=M?function(e,n){if(O&&T&&"Control"==this.docSelection.type)u(this,e);else if(n&&D)P(this,e);else{var i;A?i=this.rangeCount:(this.removeAllRanges(),i=0),this.nativeSelection.addRange(s(e)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1?(t.config.checkSelectionRanges&&(i=I(this.nativeSelection,this.rangeCount-1))&&!b.rangesEqual(i,e)&&(e=new w(i)),this._ranges[this.rangeCount-1]=e,r(this,e,j(this.nativeSelection)),this.isCollapsed=g(this)):this.refresh()}}:function(t,e){e&&D?P(this,t):(this.nativeSelection.addRange(s(t)),this.refresh())},$.setRanges=function(t){if(O&&t.length>1)h(this,t);else{this.removeAllRanges();for(var e=0,n=t.length;n>e;++e)this.addRange(t[e])}}}else{if(!(y.isHostMethod(k,"empty")&&y.isHostMethod(S,"select")&&O&&_))return e.fail("No means of selecting a Range or TextRange was found"),!1;$.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var t;if(this.anchorNode)t=v.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var e=this.docSelection.createRange();e.length&&(t=v.getDocument(e.item(0)).body.createTextRange())}t&&(t.body.createTextRange().select(),this.docSelection.empty())}}catch(n){}o(this)},$.addRange=function(t){"Control"==this.docSelection.type?u(this,t):(w.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,r(this,t,!1))},$.setRanges=function(t){this.removeAllRanges();var e=t.length;e>1?h(this,t):e&&this.addRange(t[0])}}$.getRangeAt=function(t){if(0>t||t>=this.rangeCount)throw new x("INDEX_SIZE_ERR");return this._ranges[t]};var H;if(_)H=function(e){var n;t.isSelectionValid(e.win)?n=e.docSelection.createRange():(n=v.getBody(e.win.document).createTextRange(),n.collapse(!0)),"Control"==e.docSelection.type?c(e):n&&"undefined"!=typeof n.text?l(e,n):o(e)};else if(y.isHostMethod(k,"getRangeAt")&&"number"==typeof k.rangeCount)H=function(e){if(O&&T&&"Control"==e.docSelection.type)c(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var n=0,i=e.rangeCount;i>n;++n)e._ranges[n]=new t.WrappedRange(e.nativeSelection.getRangeAt(n));r(e,e._ranges[e.rangeCount-1],j(e.nativeSelection)),e.isCollapsed=g(e)}else o(e)};else{if(!N||"boolean"!=typeof k.isCollapsed||"boolean"!=typeof S.collapsed||!t.features.implementsDomRange)return e.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;H=function(t){var e;e=t.nativeSelection,e.anchorNode?(e=I(e,0),t._ranges=[e],t.rangeCount=1,e=t.nativeSelection,t.anchorNode=e.anchorNode,t.anchorOffset=e.anchorOffset,t.focusNode=e.focusNode,t.focusOffset=e.focusOffset,t.isCollapsed=g(t)):o(t)}}$.refresh=function(t){var e=t?this._ranges.slice(0):null;if(H(this),t){if(t=e.length,t!=this._ranges.length)return!1;for(;t--;)if(!b.rangesEqual(e[t],this._ranges[t]))return!1;return!0}};var R=function(t,e){var n=t.getAllRanges(),i=!1;t.removeAllRanges();for(var r=0,s=n.length;s>r;++r)i||e!==n[r]?t.addRange(n[r]):i=!0;t.rangeCount||o(t)};$.removeRange=O?function(t){if("Control"==this.docSelection.type){for(var e,n=this.docSelection.createRange(),t=a(t),i=v.getDocument(n.item(0)),i=v.getBody(i).createControlRange(),r=!1,o=0,s=n.length;s>o;++o)e=n.item(o),e!==t||r?i.add(n.item(o)):r=!0;i.select(),c(this)}else R(this,t)}:function(t){R(this,t)};var j;!_&&N&&t.features.implementsDomRange?(j=function(t){var e=!1;return t.anchorNode&&(e=1==v.comparePoints(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)),e},$.isBackwards=function(){return j(this)}):j=$.isBackwards=function(){return!1},$.toString=function(){for(var t=[],e=0,n=this.rangeCount;n>e;++e)t[e]=""+this._ranges[e];return t.join("")},$.collapse=function(e,n){f(this,e);var i=t.createRange(v.getDocument(e));i.collapseToPoint(e,n),this.removeAllRanges(),this.addRange(i),this.isCollapsed=!0},$.collapseToStart=function(){if(!this.rangeCount)throw new x("INVALID_STATE_ERR");var t=this._ranges[0];this.collapse(t.startContainer,t.startOffset)},$.collapseToEnd=function(){if(!this.rangeCount)throw new x("INVALID_STATE_ERR");var t=this._ranges[this.rangeCount-1];this.collapse(t.endContainer,t.endOffset)},$.selectAllChildren=function(e){f(this,e);var n=t.createRange(v.getDocument(e));n.selectNodeContents(e),this.removeAllRanges(),this.addRange(n)},$.deleteFromDocument=function(){if(O&&T&&"Control"==this.docSelection.type){for(var t,e=this.docSelection.createRange();e.length;)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){e=this.getAllRanges(),this.removeAllRanges(),t=0;for(var n=e.length;n>t;++t)e[t].deleteContents();this.addRange(e[n-1])}},$.getAllRanges=function(){return this._ranges.slice(0)},$.setSingleRange=function(t){this.setRanges([t])},$.containsNode=function(t,e){for(var n=0,i=this._ranges.length;i>n;++n)if(this._ranges[n].containsNode(t,e))return!0;return!1},$.toHtml=function(){var t="";if(this.rangeCount){for(var t=b.getRangeDocument(this._ranges[0]).createElement("div"),e=0,n=this._ranges.length;n>e;++e)t.appendChild(this._ranges[e].cloneContents());t=t.innerHTML}return t},$.getName=function(){return"WrappedSelection"},$.inspect=function(){return p(this)},$.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null},d.inspect=p,t.Selection=d,t.selectionPrototype=$,t.addCreateMissingNativeApiListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return t.getSelection(this)}),e=null})});var Base=function(){};Base.extend=function(t,e){var n=Base.prototype.extend;Base._prototyping=!0;var i=new this;n.call(i,t),i.base=function(){},delete Base._prototyping;var r=i.constructor,o=i.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==o)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],i)};return o.ancestor=this,o.extend=this.extend,o.forEach=this.forEach,o.implement=this.implement,o.prototype=i,o.toString=this.toString,o.valueOf=function(t){return"object"==t?o:r.valueOf()},n.call(o,e),"function"==typeof o.init&&o.init(),o},Base.prototype={extend:function(t,e){if(1<arguments.length){var n=this[t];if(n&&"function"==typeof e&&(!n.valueOf||n.valueOf()!=e.valueOf())&&/\bbase\b/.test(e)){var i=e.valueOf(),e=function(){var t=this.base||Base.prototype.base;this.base=n;var e=i.apply(this,arguments);return this.base=t,e};e.valueOf=function(t){return"object"==t?e:i},e.toString=Base.toString}this[t]=e}else if(t){var r=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(r=this.extend||r);for(var o={toSource:null},s=["constructor","toString","valueOf"],a=Base._prototyping?0:1;l=s[a++];)t[l]!=o[l]&&r.call(this,l,t[l]);for(var l in t)o[l]||r.call(this,l,t[l])}return this}},Base=Base.extend({constructor:function(t){this.extend(t)}},{ancestor:Object,version:"1.1",forEach:function(t,e,n){for(var i in t)void 0===this.prototype[i]&&e.call(n,t[i],i,t)},implement:function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?arguments[t](this.prototype):this.prototype.extend(arguments[t]);return this},toString:function(){return""+this.valueOf()}}),wysihtml5.browser=function(){var t=navigator.userAgent,e=document.createElement("div"),n=-1!==t.indexOf("MSIE")&&-1===t.indexOf("Opera"),i=-1!==t.indexOf("Gecko")&&-1===t.indexOf("KHTML"),r=-1!==t.indexOf("AppleWebKit/"),o=-1!==t.indexOf("Chrome/"),s=-1!==t.indexOf("Opera/");return{USER_AGENT:t,supported:function(){var t=this.USER_AGENT.toLowerCase(),n="contentEditable"in e,i=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,r=document.querySelector&&document.querySelectorAll,t=this.isIos()&&5>(/ipad|iphone|ipod/.test(t)&&t.match(/ os (\d+).+? like mac os x/)||[,0])[1]||-1!==t.indexOf("opera mobi")||-1!==t.indexOf("hpwos/");return n&&i&&r&&!t},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var t=this.USER_AGENT.toLowerCase();return-1!==t.indexOf("webkit")&&-1!==t.indexOf("mobile")},supportsSandboxedIframes:function(){return n},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return!i},hasCurrentStyleProperty:function(){return"currentStyle"in e},insertsLineBreaksOnReturn:function(){return i},supportsPlaceholderAttributeOn:function(t){return"placeholder"in t},supportsEvent:function(t){var n;return(n="on"+t in e)||(e.setAttribute("on"+t,"return;"),n="function"==typeof e["on"+t]),n},supportsEventsInIframeCorrectly:function(){return!s},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return r||i},supportsDataTransfer:function(){try{return r&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(t){return!1}},supportsHTML5Tags:function(t){return t=t.createElement("div"),t.innerHTML="<article>foo</article>","<article>foo</article>"===t.innerHTML.toLowerCase()},supportsCommand:function(){var t={formatBlock:n,insertUnorderedList:n||s||r,insertOrderedList:n||s||r},e={insertHTML:i};return function(n,i){if(!t[i]){try{return n.queryCommandSupported(i)}catch(r){}try{return n.queryCommandEnabled(i)}catch(o){return!!e[i]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return i||s||r},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return i||n||s},clearsListsInContentEditableCorrectly:function(){return i||n||r},autoScrollsToCaret:function(){return!r},autoClosesUnclosedTags:function(){var t,n=e.cloneNode(!1);return n.innerHTML="<p><div></div>",n=n.innerHTML.toLowerCase(),t="<p></p><div></div>"===n||"<p><div></div></p>"===n,this.autoClosesUnclosedTags=function(){return t},t},supportsNativeGetElementsByClassName:function(){return-1!==(""+document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},supportsClassList:function(){return"classList"in e},needsSpaceAfterLineBreak:function(){return s},supportsSpeechApiOn:function(e){return 11<=(t.match(/Chrome\/(\d+)/)||[,0])[1]&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(t){return n&&("XMLHttpRequest"===t||"XDomainRequest"===t)},doesAsyncFocus:function(){return n},hasProblemsSettingCaretAfterImg:function(){return n},hasUndoInContextMenu:function(){return i||o||s}}}(),wysihtml5.lang.array=function(t){return{contains:function(e){if(t.indexOf)return-1!==t.indexOf(e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return!0;return!1},without:function(e){for(var e=wysihtml5.lang.array(e),n=[],i=0,r=t.length;r>i;i++)e.contains(t[i])||n.push(t[i]);return n},get:function(){for(var e=0,n=t.length,i=[];n>e;e++)i.push(t[e]);return i}}},wysihtml5.lang.Dispatcher=Base.extend({observe:function(t,e){return this.events=this.events||{},this.events[t]=this.events[t]||[],this.events[t].push(e),this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(t,e){this.events=this.events||{};for(var n=this.events[t]||[],i=0;i<n.length;i++)n[i].call(this,e);return this},stopObserving:function(t,e){this.events=this.events||{};var n,i,r=0;if(t){for(n=this.events[t]||[],i=[];r<n.length;r++)n[r]!==e&&e&&i.push(n[r]);this.events[t]=i}else this.events={};return this}}),wysihtml5.lang.object=function(t){return{merge:function(e){for(var n in e)t[n]=e[n];return this},get:function(){return t},clone:function(){var e,n={};for(e in t)n[e]=t[e];return n},isArray:function(){return"[object Array]"===Object.prototype.toString.call(t)}}},function(){var t=/^\s+/,e=/\s+$/;wysihtml5.lang.string=function(n){return n=""+n,{trim:function(){return n.replace(t,"").replace(e,"")},interpolate:function(t){for(var e in t)n=this.replace("#{"+e+"}").by(t[e]);return n},replace:function(t){return{by:function(e){return n.split(t).join(e)}}}}}}(),function(t){function e(t){return t.replace(r,function(t,e){var n=(e.match(o)||[])[1]||"",i=a[n],e=e.replace(o,"");e.split(i).length>e.split(n).length&&(e+=n,n="");var r=i=e;return e.length>s&&(r=r.substr(0,s)+"..."),"www."===i.substr(0,4)&&(i="http://"+i),'<a href="'+i+'">'+r+"</a>"+n})}function n(o){if(!i.contains(o.nodeName)){if(o.nodeType!==t.TEXT_NODE||!o.data.match(r)){for(a=t.lang.array(o.childNodes).get(),s=a.length,l=0;s>l;l++)n(a[l]);return o}var s,a=o.parentNode;s=a.ownerDocument;var l=s._wysihtml5_tempElement;for(l||(l=s._wysihtml5_tempElement=s.createElement("div")),s=l,s.innerHTML="<span></span>"+e(o.data),s.removeChild(s.firstChild);s.firstChild;)a.insertBefore(s.firstChild,o);a.removeChild(o)}}var i=t.lang.array("CODE PRE A SCRIPT HEAD TITLE STYLE".split(" ")),r=/((https?:\/\/|www\.)[^\s<]{3,})/gi,o=/([^\w\/\-](,?))$/i,s=100,a={")":"(","]":"[","}":"{"};t.dom.autoLink=function(t){var e;t:{e=t;for(var r;e.parentNode;){if(e=e.parentNode,r=e.nodeName,i.contains(r)){e=!0;break t}if("body"===r)break}e=!1}return e?t:(t===t.ownerDocument.documentElement&&(t=t.ownerDocument.body),n(t))},t.dom.autoLink.URL_REG_EXP=r}(wysihtml5),function(t){var e=t.browser.supportsClassList(),n=t.dom;n.addClass=function(t,i){return e?t.classList.add(i):void(n.hasClass(t,i)||(t.className+=" "+i))},n.removeClass=function(t,n){return e?t.classList.remove(n):void(t.className=t.className.replace(RegExp("(^|\\s+)"+n+"(\\s+|$)")," "))},n.hasClass=function(t,n){if(e)return t.classList.contains(n);var i=t.className;return 0<i.length&&(i==n||RegExp("(^|\\s)"+n+"(\\s|$)").test(i))}}(wysihtml5),wysihtml5.dom.contains=function(){var t=document.documentElement;return t.contains?function(t,e){return e.nodeType!==wysihtml5.ELEMENT_NODE&&(e=e.parentNode),t!==e&&t.contains(e)}:t.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:void 0}(),wysihtml5.dom.convertToList=function(){function t(t,e){var n=t.createElement("li");return e.appendChild(n),n}return function(e,n){if("UL"===e.nodeName||"OL"===e.nodeName||"MENU"===e.nodeName)return e;var i,r,o,s,a,l=e.ownerDocument,c=l.createElement(n),u=e.querySelectorAll("br"),d=u.length;for(a=0;d>a;a++)for(i=u[a];(r=i.parentNode)&&r!==e&&r.lastChild===i;){if("block"===wysihtml5.dom.getStyle("display").from(r)){r.removeChild(i);break}wysihtml5.dom.insert(i).after(i.parentNode)}for(u=wysihtml5.lang.array(e.childNodes).get(),d=u.length,a=0;d>a;a++)s=s||t(l,c),i=u[a],r="block"===wysihtml5.dom.getStyle("display").from(i),o="BR"===i.nodeName,r?(s=s.firstChild?t(l,c):s,s.appendChild(i),s=null):o?s=s.firstChild?null:s:s.appendChild(i);return e.parentNode.replaceChild(c,e),c}}(),wysihtml5.dom.copyAttributes=function(t){return{from:function(e){return{to:function(n){for(var i,r=0,o=t.length;o>r;r++)i=t[r],"undefined"!=typeof e[i]&&""!==e[i]&&(n[i]=e[i]);return{andTo:arguments.callee}}}}}},function(t){var e=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],n=function(n){var i;t:for(var r=0,o=e.length;o>r;r++)if("border-box"===t.getStyle(e[r]).from(n)){i=e[r];break t}return i?parseInt(t.getStyle("width").from(n),10)<n.offsetWidth:!1};t.copyStyles=function(i){return{from:function(r){n(r)&&(i=wysihtml5.lang.array(i).without(e));for(var o,s="",a=i.length,l=0;a>l;l++)o=i[l],s+=o+":"+t.getStyle(o).from(r)+";";return{to:function(e){return t.setStyles(s).on(e),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(t){t.dom.delegate=function(e,n,i,r){return t.dom.observe(e,i,function(i){for(var o=i.target,s=t.lang.array(e.querySelectorAll(n));o&&o!==e;){if(s.contains(o)){r.call(o,i);break}o=o.parentNode}})}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var t="abbr article aside audio bdi canvas command datalist details figcaption figure footer header hgroup keygen mark meter nav output progress rp rt ruby svg section source summary time track video wbr".split(" ");return function(e,n){var i,n=n||document;if("object"==typeof e&&e.nodeType)i=n.createElement("div"),i.appendChild(e);else if(wysihtml5.browser.supportsHTML5Tags(n))i=n.createElement("div"),i.innerHTML=e;else{if(i=n,!i._wysihtml5_supportsHTML5Tags){for(var r=0,o=t.length;o>r;r++)i.createElement(t[r]);i._wysihtml5_supportsHTML5Tags=!0}i=n,r=i.createElement("div"),r.style.display="none",i.body.appendChild(r);try{r.innerHTML=e}catch(s){}i.body.removeChild(r),i=r}return i}}(),wysihtml5.dom.getParentElement=function(){function t(t,e){return e&&e.length?"string"==typeof e?t===e:wysihtml5.lang.array(e).contains(t):!0}return function(e,n,i){if(i=i||50,n.className||n.classRegExp){t:{for(var r=n.nodeName,o=n.className,n=n.classRegExp;i--&&e&&"BODY"!==e.nodeName;){var s;if((s=e.nodeType===wysihtml5.ELEMENT_NODE)&&(s=t(e.nodeName,r))){s=o;var a=(e.className||"").match(n)||[];s=s?a[a.length-1]===s:!!a.length}if(s)break t;e=e.parentNode}e=null}return e}t:{for(r=n.nodeName,o=i;o--&&e&&"BODY"!==e.nodeName;){if(t(e.nodeName,r))break t;e=e.parentNode}e=null}return e}}(),wysihtml5.dom.getStyle=function(){function t(t){return t.replace(n,function(t){return t.charAt(1).toUpperCase()})}var e={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},n=/\-[a-z]/g;return function(n){return{from:function(i){if(i.nodeType===wysihtml5.ELEMENT_NODE){var r=i.ownerDocument,o=e[n]||t(n),s=i.style,a=i.currentStyle,l=s[o];if(l)return l;if(a)try{return a[o]}catch(c){}var u,o=r.defaultView||r.parentWindow,r=("height"===n||"width"===n)&&"TEXTAREA"===i.nodeName;if(o.getComputedStyle)return r&&(u=s.overflow,s.overflow="hidden"),i=o.getComputedStyle(i,null).getPropertyValue(n),r&&(s.overflow=u||""),i}}}}}(),wysihtml5.dom.hasElementWithTagName=function(){var t={},e=1;return function(n,i){var r=(n._wysihtml5_identifier||(n._wysihtml5_identifier=e++))+":"+i,o=t[r];return o||(o=t[r]=n.getElementsByTagName(i)),0<o.length}}(),function(t){var e={},n=1;t.dom.hasElementWithClassName=function(i,r){if(!t.browser.supportsNativeGetElementsByClassName())return!!i.querySelector("."+r);var o=(i._wysihtml5_identifier||(i._wysihtml5_identifier=n++))+":"+r,s=e[o];return s||(s=e[o]=i.getElementsByClassName(r)),0<s.length}}(wysihtml5),wysihtml5.dom.insert=function(t){return{after:function(e){e.parentNode.insertBefore(t,e.nextSibling)},before:function(e){e.parentNode.insertBefore(t,e)},into:function(e){e.appendChild(t)}}},wysihtml5.dom.insertCSS=function(t){return t=t.join("\n"),{into:function(e){var n=e.head||e.getElementsByTagName("head")[0],i=e.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(e.createTextNode(t)),n&&n.appendChild(i)}}},wysihtml5.dom.observe=function(t,e,n){for(var i,r,e="string"==typeof e?[e]:e,o=0,s=e.length;s>o;o++)r=e[o],t.addEventListener?t.addEventListener(r,n,!1):(i=function(e){"target"in e||(e.target=e.srcElement),e.preventDefault=e.preventDefault||function(){this.returnValue=!1},e.stopPropagation=e.stopPropagation||function(){this.cancelBubble=!0},n.call(t,e)},t.attachEvent("on"+r,i));return{stop:function(){for(var r,o=0,s=e.length;s>o;o++)r=e[o],t.removeEventListener?t.removeEventListener(r,n,!1):t.detachEvent("on"+r,i)}}},wysihtml5.dom.parse=function(){function t(e,r){var o,s=e.childNodes,a=s.length;o=n[e.nodeType];var l=0;if(o=o&&o(e),!o)return null;for(l=0;a>l;l++)(newChild=t(s[l],r))&&o.appendChild(newChild);return r&&1>=o.childNodes.length&&o.nodeName.toLowerCase()===i&&!o.attributes.length?o.firstChild:o}function e(t,e){var n,e=e.toLowerCase();if((n="IMG"==t.nodeName)&&(n="src"==e)){var i;try{i=t.complete&&!t.mozMatchesSelector(":-moz-broken")}catch(r){t.complete&&"complete"===t.readyState&&(i=!0)}n=!0===i}return n?t.src:a&&"outerHTML"in t?-1!=t.outerHTML.toLowerCase().indexOf(" "+e+"=")?t.getAttribute(e):null:t.getAttribute(e)}var n={1:function(t){var n,o,a=s.tags;if(o=t.nodeName.toLowerCase(),n=t.scopeName,t._wysihtml5)return null;if(t._wysihtml5=1,"wysihtml5-temp"===t.className)return null;if(n&&"HTML"!=n&&(o=n+":"+o),"outerHTML"in t&&!wysihtml5.browser.autoClosesUnclosedTags()&&"P"===t.nodeName&&"</p>"!==t.outerHTML.slice(-4).toLowerCase()&&(o="div"),o in a){if(n=a[o],!n||n.remove)return null;n="string"==typeof n?{rename_tag:n}:n}else{if(!t.firstChild)return null;n={rename_tag:i}}o=t.ownerDocument.createElement(n.rename_tag||o);var a={},u=n.set_class,d=n.add_class,h=n.set_attributes,f=n.check_attributes,p=s.classes,m=0,g=[];n=[];var v,y=[],b=[];if(h&&(a=wysihtml5.lang.object(h).clone()),f)for(v in f)(h=l[f[v]])&&(h=h(e(t,v)),"string"==typeof h&&(a[v]=h));if(u&&g.push(u),d)for(v in d)(h=c[d[v]])&&(u=h(e(t,v)),"string"==typeof u&&g.push(u));for(p["_wysihtml5-temp-placeholder"]=1,(b=t.getAttribute("class"))&&(g=g.concat(b.split(r))),d=g.length;d>m;m++)t=g[m],p[t]&&n.push(t);for(p=n.length;p--;)t=n[p],wysihtml5.lang.array(y).contains(t)||y.unshift(t);y.length&&(a["class"]=y.join(" "));for(v in a)try{o.setAttribute(v,a[v])}catch(w){}return a.src&&("undefined"!=typeof a.width&&o.setAttribute("width",a.width),"undefined"!=typeof a.height&&o.setAttribute("height",a.height)),o},3:function(t){return t.ownerDocument.createTextNode(t.data)}},i="span",r=/\s+/,o={tags:{},classes:{}},s={},a=!wysihtml5.browser.supportsGetAttributeCorrectly(),l={url:function(){var t=/^https?:\/\//i;return function(e){return e&&e.match(t)?e.replace(t,function(t){return t.toLowerCase()}):null}}(),alt:function(){var t=/[^ a-z0-9_\-]/gi;return function(e){return e?e.replace(t,""):""}}(),numbers:function(){var t=/\D/g;return function(e){return(e=(e||"").replace(t,""))||null}}()},c={align_img:function(){var t={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(e){return t[(""+e).toLowerCase()]}}(),align_text:function(){var t={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(e){return t[(""+e).toLowerCase()]}}(),clear_br:function(){var t={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(e){return t[(""+e).toLowerCase()]}}(),size_font:function(){var t={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(e){return t[(""+e).charAt(0)]}}()};return function(e,n,i,r){wysihtml5.lang.object(s).merge(o).merge(n).get();for(var i=i||e.ownerDocument||document,n=i.createDocumentFragment(),a="string"==typeof e,e=a?wysihtml5.dom.getAsDom(e,i):e;e.firstChild;)i=e.firstChild,e.removeChild(i),(i=t(i,r))&&n.appendChild(i);return e.innerHTML="",e.appendChild(n),a?wysihtml5.quirks.getCorrectInnerHTML(e):e}}(),wysihtml5.dom.removeEmptyTextNodes=function(t){for(var e=wysihtml5.lang.array(t.childNodes).get(),n=e.length,i=0;n>i;i++)t=e[i],t.nodeType===wysihtml5.TEXT_NODE&&""===t.data&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(t,e){for(var n,i=t.ownerDocument.createElement(e);n=t.firstChild;)i.appendChild(n);return wysihtml5.dom.copyAttributes(["align","className"]).from(t).to(i),t.parentNode.replaceChild(i,t),i},wysihtml5.dom.replaceWithChildNodes=function(t){if(t.parentNode)if(t.firstChild){for(var e=t.ownerDocument.createDocumentFragment();t.firstChild;)e.appendChild(t.firstChild);t.parentNode.replaceChild(e,t)}else t.parentNode.removeChild(t)},function(t){function e(t){var e=t.ownerDocument.createElement("br");t.appendChild(e)}t.resolveList=function(n){if("MENU"===n.nodeName||"UL"===n.nodeName||"OL"===n.nodeName){var i,r,o,s=n.ownerDocument.createDocumentFragment(),a=n.previousElementSibling||n.previousSibling;for(a&&"block"!==t.getStyle("display").from(a)&&e(s);o=n.firstChild;){for(i=o.lastChild;a=o.firstChild;)r=(r=a===i)&&"block"!==t.getStyle("display").from(a)&&"BR"!==a.nodeName,s.appendChild(a),r&&e(s);o.parentNode.removeChild(o)}n.parentNode.replaceChild(s,n)}}}(wysihtml5.dom),function(t){var e=document,n="parent top opener frameElement frames localStorage globalStorage sessionStorage indexedDB".split(" "),i="open close openDialog showModalDialog alert confirm prompt openDatabase postMessage XMLHttpRequest XDomainRequest".split(" "),r=["referrer","write","open","close"];t.dom.Sandbox=Base.extend({constructor:function(e,n){this.callback=e||t.EMPTY_FUNCTION,this.config=t.lang.object({}).merge(n).get(),this.iframe=this._createIframe()},insertInto:function(t){"string"==typeof t&&(t=e.getElementById(t)),t.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var t=this.getIframe();t.parentNode.removeChild(t)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var n=this,i=e.createElement("iframe");return i.className="wysihtml5-sandbox",t.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(i),t.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(i.src="javascript:'<html></html>'"),i.onload=function(){i.onreadystatechange=i.onload=null,n._onLoadIframe(i)},i.onreadystatechange=function(){/loaded|complete/.test(i.readyState)&&(i.onreadystatechange=i.onload=null,n._onLoadIframe(i))},i},_onLoadIframe:function(o){if(t.dom.contains(e.documentElement,o)){var s=this,a=o.contentWindow,l=o.contentWindow.document,c=this._getHtml({charset:e.characterSet||e.charset||"utf-8",stylesheets:this.config.stylesheets});if(l.open("text/html","replace"),l.write(c),l.close(),this.getWindow=function(){return o.contentWindow},this.getDocument=function(){return o.contentWindow.document},a.onerror=function(t,e,n){throw Error("wysihtml5.Sandbox: "+t,e,n)},!t.browser.supportsSandboxedIframes()){var u,c=0;for(u=n.length;u>c;c++)this._unset(a,n[c]);for(c=0,u=i.length;u>c;c++)this._unset(a,i[c],t.EMPTY_FUNCTION);for(c=0,u=r.length;u>c;c++)this._unset(l,r[c]);this._unset(l,"cookie","",!0)}this.loaded=!0,setTimeout(function(){s.callback(s)},0)}},_getHtml:function(e){var n,i=e.stylesheets,r="",o=0;if(i="string"==typeof i?[i]:i)for(n=i.length;n>o;o++)r+='<link rel="stylesheet" href="'+i[o]+'">';return e.stylesheets=r,t.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(e)},_unset:function(e,n,i,r){try{e[n]=i}catch(o){}try{e.__defineGetter__(n,function(){return i})}catch(s){}if(r)try{e.__defineSetter__(n,function(){})}catch(a){}if(!t.browser.crashesWhenDefineProperty(n))try{var l={get:function(){return i}};r&&(l.set=function(){}),Object.defineProperty(e,n,l)}catch(c){}}})}(wysihtml5),function(){var t={className:"class"};wysihtml5.dom.setAttributes=function(e){return{on:function(n){for(var i in e)n.setAttribute(t[i]||i,e[i])}}}}(),wysihtml5.dom.setStyles=function(t){return{on:function(e){if(e=e.style,"string"==typeof t)e.cssText+=";"+t;else for(var n in t)"float"===n?(e.cssFloat=t[n],e.styleFloat=t[n]):e[n]=t[n]}}},function(t){t.simulatePlaceholder=function(e,n,i){var r=function(){n.hasPlaceholderSet()&&n.clear(),t.removeClass(n.element,"placeholder")},o=function(){n.isEmpty()&&(n.setValue(i),t.addClass(n.element,"placeholder"))};e.observe("set_placeholder",o).observe("unset_placeholder",r).observe("focus:composer",r).observe("paste:composer",r).observe("blur:composer",o),o()}}(wysihtml5.dom),function(t){var e=document.documentElement;"textContent"in e?(t.setTextContent=function(t,e){t.textContent=e},t.getTextContent=function(t){return t.textContent}):"innerText"in e?(t.setTextContent=function(t,e){t.innerText=e},t.getTextContent=function(t){return t.innerText}):(t.setTextContent=function(t,e){t.nodeValue=e},t.getTextContent=function(t){return t.nodeValue})}(wysihtml5.dom),wysihtml5.quirks.cleanPastedHTML=function(){var t={"a u":wysihtml5.dom.replaceWithChildNodes};return function(e,n,i){var r,o,s,n=n||t,i=i||e.ownerDocument||document,a="string"==typeof e,l=0,e=a?wysihtml5.dom.getAsDom(e,i):e;for(s in n)for(r=e.querySelectorAll(s),i=n[s],o=r.length;o>l;l++)i(r[l]);return a?e.innerHTML:e}}(),function(t){var e=t.dom;t.quirks.ensureProperClearing=function(){var t=function(){var t=this;setTimeout(function(){var e=t.innerHTML.toLowerCase();("<p>&nbsp;</p>"==e||"<p>&nbsp;</p><p>&nbsp;</p>"==e)&&(t.innerHTML="")},0)};return function(n){e.observe(n.element,["cut","keydown"],t)}}(),t.quirks.ensureProperClearingOfLists=function(){var n=["OL","UL","MENU"];return function(i){e.observe(i.element,"keydown",function(r){if(r.keyCode===t.BACKSPACE_KEY){var o=i.selection.getSelectedNode(),r=i.element;r.firstChild&&t.lang.array(n).contains(r.firstChild.nodeName)&&(o=e.getParentElement(o,{nodeName:n}))&&o==r.firstChild&&1>=o.childNodes.length&&(o.firstChild?""===o.firstChild.innerHTML:1)&&o.parentNode.removeChild(o)}})}}()}(wysihtml5),function(t){t.quirks.getCorrectInnerHTML=function(e){var n=e.innerHTML;if(-1===n.indexOf("%7E"))return n;var i,r,o,s,e=e.querySelectorAll("[href*='~'], [src*='~']");for(s=0,o=e.length;o>s;s++)i=e[s].href||e[s].src,r=t.lang.string(i).replace("~").by("%7E"),n=t.lang.string(n).replace(r).by(i);return n}}(wysihtml5),function(t){var e=t.dom,n="LI P H1 H2 H3 H4 H5 H6".split(" "),i=["UL","OL","MENU"];t.quirks.insertLineBreakOnReturn=function(r){function o(n){if(n=e.getParentElement(n,{nodeName:["P","DIV"]},2)){var i=document.createTextNode(t.INVISIBLE_SPACE);e.insert(i).before(n),e.replaceWithChildNodes(n),r.selection.selectNode(i)}}e.observe(r.element.ownerDocument,"keydown",function(s){var a=s.keyCode;if(!(s.shiftKey||a!==t.ENTER_KEY&&a!==t.BACKSPACE_KEY)){var l=r.selection.getSelectedNode();(l=e.getParentElement(l,{nodeName:n},4))?"LI"!==l.nodeName||a!==t.ENTER_KEY&&a!==t.BACKSPACE_KEY?l.nodeName.match(/H[1-6]/)&&a===t.ENTER_KEY&&setTimeout(function(){o(r.selection.getSelectedNode())},0):setTimeout(function(){var t,n=r.selection.getSelectedNode();n&&((t=e.getParentElement(n,{nodeName:i},2))||o(n))},0):a===t.ENTER_KEY&&!t.browser.insertsLineBreaksOnReturn()&&(r.commands.exec("insertLineBreak"),s.preventDefault())
}})}}(wysihtml5),function(t){t.quirks.redraw=function(e){t.dom.addClass(e,"wysihtml5-quirks-redraw"),t.dom.removeClass(e,"wysihtml5-quirks-redraw");try{var n=e.ownerDocument;n.execCommand("italic",!1,null),n.execCommand("italic",!1,null)}catch(i){}}}(wysihtml5),function(t){var e=t.dom;t.Selection=Base.extend({constructor:function(t){window.rangy.init(),this.editor=t,this.composer=t.composer,this.doc=this.composer.doc},getBookmark:function(){var t=this.getRange();return t&&t.cloneRange()},setBookmark:function(t){t&&this.setSelection(t)},setBefore:function(t){var e=rangy.createRange(this.doc);return e.setStartBefore(t),e.setEndBefore(t),this.setSelection(e)},setAfter:function(t){var e=rangy.createRange(this.doc);return e.setStartAfter(t),e.setEndAfter(t),this.setSelection(e)},selectNode:function(n){var i=rangy.createRange(this.doc),r=n.nodeType===t.ELEMENT_NODE,o="canHaveHTML"in n?n.canHaveHTML:"IMG"!==n.nodeName,s=r?n.innerHTML:n.data,s=""===s||s===t.INVISIBLE_SPACE,a=e.getStyle("display").from(n),a="block"===a||"list-item"===a;if(s&&r&&o)try{n.innerHTML=t.INVISIBLE_SPACE}catch(l){}o?i.selectNodeContents(n):i.selectNode(n),o&&s&&r?i.collapse(a):o&&s&&(i.setStartAfter(n),i.setEndAfter(n)),this.setSelection(i)},getSelectedNode:function(t){return t&&this.doc.selection&&"Control"===this.doc.selection.type&&(t=this.doc.selection.createRange())&&t.length?t.item(0):(t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(t=this.getRange(this.doc))?t.commonAncestorContainer:this.doc.body)},executeAndRestore:function(e,n){var i=this.doc.body,r=n&&i.scrollTop,o=n&&i.scrollLeft,s='<span class="_wysihtml5-temp-placeholder">'+t.INVISIBLE_SPACE+"</span>",a=this.getRange(this.doc);if(a){s=a.createContextualFragment(s),a.insertNode(s);try{e(a.startContainer,a.endContainer)}catch(l){setTimeout(function(){throw l},0)}(caretPlaceholder=this.doc.querySelector("._wysihtml5-temp-placeholder"))?(a=rangy.createRange(this.doc),a.selectNode(caretPlaceholder),a.deleteContents(),this.setSelection(a)):i.focus(),n&&(i.scrollTop=r,i.scrollLeft=o);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(c){}}else e(i,i)},executeAndRestoreSimple:function(t){var e,n,i,r=this.getRange(),o=this.doc.body;if(r){e=r.getNodes([3]),o=e[0]||r.startContainer,i=e[e.length-1]||r.endContainer,e=o===r.startContainer?r.startOffset:0,n=i===r.endContainer?r.endOffset:i.length;try{t(r.startContainer,r.endContainer)}catch(s){setTimeout(function(){throw s},0)}t=rangy.createRange(this.doc);try{t.setStart(o,e)}catch(a){}try{t.setEnd(i,n)}catch(l){}try{this.setSelection(t)}catch(c){}}else t(o,o)},insertHTML:function(t){var t=rangy.createRange(this.doc).createContextualFragment(t),e=t.lastChild;this.insertNode(t),e&&this.setAfter(e)},insertNode:function(t){var e=this.getRange();e&&e.insertNode(t)},surround:function(t){var e=this.getRange();if(e)try{e.surroundContents(t),this.selectNode(t)}catch(n){t.appendChild(e.extractContents()),e.insertNode(t)}},scrollIntoView:function(){var e,n=this.doc,i=n.documentElement.scrollHeight>n.documentElement.offsetHeight;if((e=n._wysihtml5ScrollIntoViewElement)||(e=n.createElement("span"),e.innerHTML=t.INVISIBLE_SPACE),e=n._wysihtml5ScrollIntoViewElement=e,i){this.insertNode(e);var i=e,r=0;if(i.parentNode)do r+=i.offsetTop||0,i=i.offsetParent;while(i);i=r,e.parentNode.removeChild(e),i>n.body.scrollTop&&(n.body.scrollTop=i)}},selectLine:function(){t.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var t=this.doc.defaultView.getSelection();t.modify("extend","left","lineboundary"),t.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var t,e=this.doc.selection.createRange(),n=e.boundingTop,i=this.doc.body.scrollWidth;if(e.moveToPoint){for(0===n&&(t=this.doc.createElement("span"),this.insertNode(t),n=t.offsetTop,t.parentNode.removeChild(t)),n+=1,t=-10;i>t;t+=2)try{e.moveToPoint(t,n);break}catch(r){}for(t=this.doc.selection.createRange();i>=0;i--)try{t.moveToPoint(i,n);break}catch(o){}e.setEndPoint("EndToEnd",t),e.select()}},getText:function(){var t=this.getSelection();return t?t.toString():""},getNodes:function(t,e){var n=this.getRange();return n?n.getNodes([t],e):[]},getRange:function(){var t=this.getSelection();return t&&t.rangeCount&&t.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(t){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow).setSingleRange(t)}})}(wysihtml5),function(t,e){function n(t,n){return e.dom.isCharacterDataNode(t)?0==n?!!t.previousSibling:n==t.length?!!t.nextSibling:!0:n>0&&n<t.childNodes.length}function i(t,n,r){var o;if(e.dom.isCharacterDataNode(n)&&(0==r?(r=e.dom.getNodeIndex(n),n=n.parentNode):r==n.length?(r=e.dom.getNodeIndex(n)+1,n=n.parentNode):o=e.dom.splitDataNode(n,r)),!o){o=n.cloneNode(!1),o.id&&o.removeAttribute("id");for(var s;s=n.childNodes[r];)o.appendChild(s);e.dom.insertAfter(o,n)}return n==t?o:i(t,o.parentNode,e.dom.getNodeIndex(o))}function r(e){this.firstTextNode=(this.isElementMerge=e.nodeType==t.ELEMENT_NODE)?e.lastChild:e,this.textNodes=[this.firstTextNode]}function o(t,e,n,i){this.tagNames=t||[s],this.cssClass=e||"",this.similarClassRegExp=n,this.normalize=i,this.applyToAnyTagName=!1}var s="span",a=/\s+/g;r.prototype={doMerge:function(){for(var t,e,n=[],i=0,r=this.textNodes.length;r>i;++i)t=this.textNodes[i],e=t.parentNode,n[i]=t.data,i&&(e.removeChild(t),e.hasChildNodes()||e.parentNode.removeChild(e));return this.firstTextNode.data=n=n.join("")},getLength:function(){for(var t=this.textNodes.length,e=0;t--;)e+=this.textNodes[t].length;return e},toString:function(){for(var t=[],e=0,n=this.textNodes.length;n>e;++e)t[e]="'"+this.textNodes[e].data+"'";return"[Merge("+t.join(",")+")]"}},o.prototype={getAncestorWithClass:function(n){for(var i;n;){if(this.cssClass)if(i=this.cssClass,n.className){var r=n.className.match(this.similarClassRegExp)||[];i=r[r.length-1]===i}else i=!1;else i=!0;if(n.nodeType==t.ELEMENT_NODE&&e.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&i)return n;n=n.parentNode}return!1},postApply:function(t,e){for(var n,i,o,s=t[0],a=t[t.length-1],l=[],c=s,u=a,d=0,h=a.length,f=0,p=t.length;p>f;++f)i=t[f],(o=this.getAdjacentMergeableTextNode(i.parentNode,!1))?(n||(n=new r(o),l.push(n)),n.textNodes.push(i),i===s&&(c=n.firstTextNode,d=c.length),i===a&&(u=n.firstTextNode,h=n.getLength())):n=null;if((s=this.getAdjacentMergeableTextNode(a.parentNode,!0))&&(n||(n=new r(a),l.push(n)),n.textNodes.push(s)),l.length){for(f=0,p=l.length;p>f;++f)l[f].doMerge();e.setStart(c,d),e.setEnd(u,h)}},getAdjacentMergeableTextNode:function(e,n){var i=e.nodeType==t.TEXT_NODE,r=i?e.parentNode:e,o=n?"nextSibling":"previousSibling";if(i){if((i=e[o])&&i.nodeType==t.TEXT_NODE)return i}else if((i=r[o])&&this.areElementsMergeable(e,i))return i[n?"firstChild":"lastChild"];return null},areElementsMergeable:function(t,n){var i;if((i=e.dom.arrayContains(this.tagNames,(t.tagName||"").toLowerCase()))&&(i=e.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase()))&&(i=t.className.replace(a," ")==n.className.replace(a," ")))t:if(t.attributes.length!=n.attributes.length)i=!1;else{i=0;for(var r,o,s=t.attributes.length;s>i;++i)if(r=t.attributes[i],o=r.name,"class"!=o&&(o=n.attributes.getNamedItem(o),r.specified!=o.specified||r.specified&&r.nodeValue!==o.nodeValue)){i=!1;break t}i=!0}return i},createContainer:function(t){return t=t.createElement(this.tagNames[0]),this.cssClass&&(t.className=this.cssClass),t},applyToTextNode:function(t){var n=t.parentNode;1==n.childNodes.length&&e.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())?this.cssClass&&(t=this.cssClass,n.className?(n.className&&(n.className=n.className.replace(this.similarClassRegExp,"")),n.className+=" "+t):n.className=t):(n=this.createContainer(e.dom.getDocument(t)),t.parentNode.insertBefore(n,t),n.appendChild(t))},isRemovable:function(n){return e.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&t.lang.string(n.className).trim()==this.cssClass},undoToTextNode:function(t,e,r){if(e.containsNode(r)||(t=e.cloneRange(),t.selectNode(r),t.isPointInRange(e.endContainer,e.endOffset)&&n(e.endContainer,e.endOffset)&&(i(r,e.endContainer,e.endOffset),e.setEndAfter(r)),t.isPointInRange(e.startContainer,e.startOffset)&&n(e.startContainer,e.startOffset)&&(r=i(r,e.startContainer,e.startOffset))),this.similarClassRegExp&&r.className&&(r.className=r.className.replace(this.similarClassRegExp,"")),this.isRemovable(r)){for(e=r,r=e.parentNode;e.firstChild;)r.insertBefore(e.firstChild,e);r.removeChild(e)}},applyToRange:function(e){var n=e.getNodes([t.TEXT_NODE]);if(!n.length)try{var i=this.createContainer(e.endContainer.ownerDocument);return e.surroundContents(i),void this.selectNode(e,i)}catch(r){}if(e.splitBoundaries(),n=e.getNodes([t.TEXT_NODE]),n.length){for(var o=0,s=n.length;s>o;++o)i=n[o],this.getAncestorWithClass(i)||this.applyToTextNode(i);e.setStart(n[0],0),i=n[n.length-1],e.setEnd(i,i.length),this.normalize&&this.postApply(n,e)}},undoToRange:function(e){var n,i,r=e.getNodes([t.TEXT_NODE]);r.length?(e.splitBoundaries(),r=e.getNodes([t.TEXT_NODE])):(r=e.endContainer.ownerDocument.createTextNode(t.INVISIBLE_SPACE),e.insertNode(r),e.selectNode(r),r=[r]);for(var o=0,s=r.length;s>o;++o)n=r[o],(i=this.getAncestorWithClass(n))&&this.undoToTextNode(n,e,i);1==s?this.selectNode(e,r[0]):(e.setStart(r[0],0),n=r[r.length-1],e.setEnd(n,n.length),this.normalize&&this.postApply(r,e))},selectNode:function(e,n){var i=n.nodeType===t.ELEMENT_NODE,r="canHaveHTML"in n?n.canHaveHTML:!0,o=i?n.innerHTML:n.data;if((o=""===o||o===t.INVISIBLE_SPACE)&&i&&r)try{n.innerHTML=t.INVISIBLE_SPACE}catch(s){}e.selectNodeContents(n),o&&i?e.collapse(!1):o&&(e.setStartAfter(n),e.setEndAfter(n))},getTextSelectedByRange:function(t,e){var n=e.cloneRange();n.selectNodeContents(t);var i=n.intersection(e),i=i?i.toString():"";return n.detach(),i},isAppliedToRange:function(e){var n,i=[],r=e.getNodes([t.TEXT_NODE]);if(!r.length)return(n=this.getAncestorWithClass(e.startContainer))?[n]:!1;for(var o,s=0,a=r.length;a>s;++s){if(o=this.getTextSelectedByRange(r[s],e),n=this.getAncestorWithClass(r[s]),""!=o&&!n)return!1;i.push(n)}return i},toggleRange:function(t){this.isAppliedToRange(t)?this.undoToRange(t):this.applyToRange(t)}},t.selection.HTMLApplier=o}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(t){this.editor=t,this.composer=t.composer,this.doc=this.composer.doc},support:function(t){return wysihtml5.browser.supportsCommand(this.doc,t)},exec:function(t,e){var n=wysihtml5.commands[t],i=wysihtml5.lang.array(arguments).get(),r=n&&n.exec,o=null;if(this.editor.fire("beforecommand:composer"),r)i.unshift(this.composer),o=r.apply(n,i);else try{o=this.doc.execCommand(t,!1,e)}catch(s){}return this.editor.fire("aftercommand:composer"),o},state:function(t){var e=wysihtml5.commands[t],n=wysihtml5.lang.array(arguments).get(),i=e&&e.state;if(i)return n.unshift(this.composer),i.apply(e,n);try{return this.doc.queryCommandState(t)}catch(r){return!1}},value:function(t){var e=wysihtml5.commands[t],n=e&&e.value;if(n)return n.call(e,this.composer,t);try{return this.doc.queryCommandValue(t)}catch(i){return null}}}),function(t){t.commands.bold={exec:function(e,n){return t.commands.formatInline.exec(e,n,"b")},state:function(e,n){return t.commands.formatInline.state(e,n,"b")},value:function(){}}}(wysihtml5),function(t){function e(e,o){var s,a,l,c=e.doc,u="_wysihtml5-temp-"+ +new Date,d=0;for(t.commands.formatInline.exec(e,n,i,u,/non-matching-class/g),s=c.querySelectorAll(i+"."+u),u=s.length;u>d;d++)for(l in a=s[d],a.removeAttribute("class"),o)a.setAttribute(l,o[l]);d=a,1===u&&(l=r.getTextContent(a),u=!!a.querySelector("*"),l=""===l||l===t.INVISIBLE_SPACE,!u&&l&&(r.setTextContent(a,o.text||a.href),c=c.createTextNode(" "),e.selection.setAfter(a),e.selection.insertNode(c),d=c)),e.selection.setAfter(d)}var n,i="A",r=t.dom;t.commands.createLink={exec:function(t,n,i){var o=this.state(t,n);o?t.selection.executeAndRestore(function(){for(var t,e,n,i=o.length,s=0;i>s;s++)t=o[s],e=r.getParentElement(t,{nodeName:"code"}),n=r.getTextContent(t),n.match(r.autoLink.URL_REG_EXP)&&!e?r.renameElement(t,"code"):r.replaceWithChildNodes(t)}):(i="object"==typeof i?i:{href:i},e(t,i))},state:function(e,n){return t.commands.formatInline.state(e,n,"A")},value:function(){return n}}}(wysihtml5),function(t){var e=/wysiwyg-font-size-[a-z\-]+/g;t.commands.fontSize={exec:function(n,i,r){return t.commands.formatInline.exec(n,i,"span","wysiwyg-font-size-"+r,e)},state:function(n,i,r){return t.commands.formatInline.state(n,i,"span","wysiwyg-font-size-"+r,e)},value:function(){}}}(wysihtml5),function(t){var e=/wysiwyg-color-[a-z]+/g;t.commands.foreColor={exec:function(n,i,r){return t.commands.formatInline.exec(n,i,"span","wysiwyg-color-"+r,e)},state:function(n,i,r){return t.commands.formatInline.state(n,i,"span","wysiwyg-color-"+r,e)},value:function(){}}}(wysihtml5),function(t){function e(e){for(e=e.previousSibling;e&&e.nodeType===t.TEXT_NODE&&!t.lang.string(e.data).trim();)e=e.previousSibling;return e}function n(e){for(e=e.nextSibling;e&&e.nodeType===t.TEXT_NODE&&!t.lang.string(e.data).trim();)e=e.nextSibling;return e}function i(t){return"BR"===t.nodeName||"block"===s.getStyle("display").from(t)?!0:!1}function r(e,n,i,r){if(r)var o=s.observe(e,"DOMNodeInserted",function(e){var n,e=e.target;e.nodeType===t.ELEMENT_NODE&&(n=s.getStyle("display").from(e),"inline"!==n.substr(0,6)&&(e.className+=" "+r))});e.execCommand(n,!1,i),o&&o.stop()}function o(t,i){t.selection.selectLine(),t.selection.surround(i);var r=n(i),o=e(i);r&&"BR"===r.nodeName&&r.parentNode.removeChild(r),o&&"BR"===o.nodeName&&o.parentNode.removeChild(o),(r=i.lastChild)&&"BR"===r.nodeName&&r.parentNode.removeChild(r),t.selection.selectNode(i)}var s=t.dom,a="H1 H2 H3 H4 H5 H6 P BLOCKQUOTE DIV".split(" ");t.commands.formatBlock={exec:function(l,c,u,d,h){var f,p=l.doc,m=this.state(l,c,u,d,h),u="string"==typeof u?u.toUpperCase():u;if(m)l.selection.executeAndRestoreSimple(function(){h&&(m.className=m.className.replace(h,""));var r=!!t.lang.string(m.className).trim();if(r||m.nodeName!==(u||"DIV"))r&&s.renameElement(m,"DIV");else{var r=m,o=r.ownerDocument,a=n(r),l=e(r);a&&!i(a)&&r.parentNode.insertBefore(o.createElement("br"),a),l&&!i(l)&&r.parentNode.insertBefore(o.createElement("br"),r),s.replaceWithChildNodes(m)}});else{if((null===u||t.lang.array(a).contains(u))&&(f=l.selection.getSelectedNode(),m=s.getParentElement(f,{nodeName:a})))return void l.selection.executeAndRestoreSimple(function(){if(u&&(m=s.renameElement(m,u)),d){var t=m;t.className?(t.className=t.className.replace(h,""),t.className+=" "+d):t.className=d}});l.commands.support(c)?r(p,c,u||"DIV",d):(m=p.createElement(u||"DIV"),d&&(m.className=d),o(l,m))}},state:function(t,e,n,i,r){return n="string"==typeof n?n.toUpperCase():n,t=t.selection.getSelectedNode(),s.getParentElement(t,{nodeName:n,className:i,classRegExp:r})},value:function(){}}}(wysihtml5),function(t){function e(e,r,o){var s=e+":"+r;if(!i[s]){var a=i,l=t.selection.HTMLApplier,c=n[e],e=c?[e.toLowerCase(),c.toLowerCase()]:[e.toLowerCase()];a[s]=new l(e,r,o,!0)}return i[s]}var n={strong:"b",em:"i",b:"strong",i:"em"},i={};t.commands.formatInline={exec:function(t,n,i,r,o){return(n=t.selection.getRange())?(e(i,r,o).toggleRange(n),void t.selection.setSelection(n)):!1},state:function(i,r,o,s,a){var r=i.doc,l=n[o]||o;return!t.dom.hasElementWithTagName(r,o)&&!t.dom.hasElementWithTagName(r,l)||s&&!t.dom.hasElementWithClassName(r,s)?!1:(i=i.selection.getRange(),i?e(o,s,a).isAppliedToRange(i):!1)},value:function(){}}}(wysihtml5),function(t){t.commands.insertHTML={exec:function(t,e,n){t.commands.support(e)?t.doc.execCommand(e,!1,n):t.selection.insertHTML(n)},state:function(){return!1},value:function(){}}}(wysihtml5),function(t){t.commands.insertImage={exec:function(e,n,i){var r,i="object"==typeof i?i:{src:i},o=e.doc,n=this.state(e);if(n)e.selection.setBefore(n),i=n.parentNode,i.removeChild(n),t.dom.removeEmptyTextNodes(i),"A"===i.nodeName&&!i.firstChild&&(e.selection.setAfter(i),i.parentNode.removeChild(i)),t.quirks.redraw(e.element);else{n=o.createElement("IMG");for(r in i)n[r]=i[r];e.selection.insertNode(n),t.browser.hasProblemsSettingCaretAfterImg()?(i=o.createTextNode(t.INVISIBLE_SPACE),e.selection.insertNode(i),e.selection.setAfter(i)):e.selection.setAfter(n)}},state:function(e){var n;return t.dom.hasElementWithTagName(e.doc,"IMG")&&(n=e.selection.getSelectedNode())?"IMG"===n.nodeName?n:n.nodeType!==t.ELEMENT_NODE?!1:(n=e.selection.getText(),(n=t.lang.string(n).trim())?!1:(e=e.selection.getNodes(t.ELEMENT_NODE,function(t){return"IMG"===t.nodeName}),1!==e.length?!1:e[0])):!1},value:function(t){return(t=this.state(t))&&t.src}}}(wysihtml5),function(t){var e="<br>"+(t.browser.needsSpaceAfterLineBreak()?" ":"");t.commands.insertLineBreak={exec:function(n,i){n.commands.support(i)?(n.doc.execCommand(i,!1,null),t.browser.autoScrollsToCaret()||n.selection.scrollIntoView()):n.commands.exec("insertHTML",e)},state:function(){return!1},value:function(){}}}(wysihtml5),function(t){t.commands.insertOrderedList={exec:function(e,n){var i,r=e.doc,o=e.selection.getSelectedNode(),s=t.dom.getParentElement(o,{nodeName:"OL"}),a=t.dom.getParentElement(o,{nodeName:"UL"}),o="_wysihtml5-temp-"+(new Date).getTime();e.commands.support(n)?r.execCommand(n,!1,null):s?e.selection.executeAndRestoreSimple(function(){t.dom.resolveList(s)}):a?e.selection.executeAndRestoreSimple(function(){t.dom.renameElement(a,"ol")}):(e.commands.exec("formatBlock","div",o),i=r.querySelector("."+o),r=""===i.innerHTML||i.innerHTML===t.INVISIBLE_SPACE,e.selection.executeAndRestoreSimple(function(){s=t.dom.convertToList(i,"ol")}),r&&e.selection.selectNode(s.querySelector("li")))},state:function(e){return e=e.selection.getSelectedNode(),t.dom.getParentElement(e,{nodeName:"OL"})},value:function(){}}}(wysihtml5),function(t){t.commands.insertUnorderedList={exec:function(e,n){var i,r=e.doc,o=e.selection.getSelectedNode(),s=t.dom.getParentElement(o,{nodeName:"UL"}),a=t.dom.getParentElement(o,{nodeName:"OL"}),o="_wysihtml5-temp-"+(new Date).getTime();e.commands.support(n)?r.execCommand(n,!1,null):s?e.selection.executeAndRestoreSimple(function(){t.dom.resolveList(s)}):a?e.selection.executeAndRestoreSimple(function(){t.dom.renameElement(a,"ul")}):(e.commands.exec("formatBlock","div",o),i=r.querySelector("."+o),r=""===i.innerHTML||i.innerHTML===t.INVISIBLE_SPACE,e.selection.executeAndRestoreSimple(function(){s=t.dom.convertToList(i,"ul")}),r&&e.selection.selectNode(s.querySelector("li")))},state:function(e){return e=e.selection.getSelectedNode(),t.dom.getParentElement(e,{nodeName:"UL"})},value:function(){}}}(wysihtml5),function(t){t.commands.italic={exec:function(e,n){return t.commands.formatInline.exec(e,n,"i")},state:function(e,n){return t.commands.formatInline.state(e,n,"i")},value:function(){}}}(wysihtml5),function(t){var e=/wysiwyg-text-align-[a-z]+/g;t.commands.justifyCenter={exec:function(n){return t.commands.formatBlock.exec(n,"formatBlock",null,"wysiwyg-text-align-center",e)},state:function(n){return t.commands.formatBlock.state(n,"formatBlock",null,"wysiwyg-text-align-center",e)},value:function(){}}}(wysihtml5),function(t){var e=/wysiwyg-text-align-[a-z]+/g;t.commands.justifyLeft={exec:function(n){return t.commands.formatBlock.exec(n,"formatBlock",null,"wysiwyg-text-align-left",e)},state:function(n){return t.commands.formatBlock.state(n,"formatBlock",null,"wysiwyg-text-align-left",e)},value:function(){}}}(wysihtml5),function(t){var e=/wysiwyg-text-align-[a-z]+/g;t.commands.justifyRight={exec:function(n){return t.commands.formatBlock.exec(n,"formatBlock",null,"wysiwyg-text-align-right",e)},state:function(n){return t.commands.formatBlock.state(n,"formatBlock",null,"wysiwyg-text-align-right",e)},value:function(){}}}(wysihtml5),function(t){t.commands.underline={exec:function(e,n){return t.commands.formatInline.exec(e,n,"u")},state:function(e,n){return t.commands.formatInline.state(e,n,"u")},value:function(){}}}(wysihtml5),function(t){var e='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+t.INVISIBLE_SPACE+"</span>",n='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+t.INVISIBLE_SPACE+"</span>",i=t.dom;t.UndoManager=t.lang.Dispatcher.extend({constructor:function(t){this.editor=t,this.composer=t.composer,this.element=this.composer.element,this.history=[this.composer.getValue()],this.position=1,this.composer.commands.support("insertHTML")&&this._observe()},_observe:function(){var r,o=this,s=this.composer.sandbox.getDocument();if(i.observe(this.element,"keydown",function(t){if(!t.altKey&&(t.ctrlKey||t.metaKey)){var e=t.keyCode,n=90===e&&t.shiftKey||89===e;90!==e||t.shiftKey?n&&(o.redo(),t.preventDefault()):(o.undo(),t.preventDefault())}}),i.observe(this.element,"keydown",function(t){t=t.keyCode,t!==r&&(r=t,(8===t||46===t)&&o.transact())}),t.browser.hasUndoInContextMenu()){var a,l,c=function(){for(var t;t=s.querySelector("._wysihtml5-temp");)t.parentNode.removeChild(t);clearInterval(a)};i.observe(this.element,"contextmenu",function(){c(),o.composer.selection.executeAndRestoreSimple(function(){o.element.lastChild&&o.composer.selection.setAfter(o.element.lastChild),s.execCommand("insertHTML",!1,e),s.execCommand("insertHTML",!1,n),s.execCommand("undo",!1,null)}),a=setInterval(function(){s.getElementById("_wysihtml5-redo")?(c(),o.redo()):s.getElementById("_wysihtml5-undo")||(c(),o.undo())},400),l||(l=!0,i.observe(document,"mousedown",c),i.observe(s,["mousedown","paste","cut","copy"],c))})}this.editor.observe("newword:composer",function(){o.transact()}).observe("beforecommand:composer",function(){o.transact()})},transact:function(){var t=this.history[this.position-1],e=this.composer.getValue();e!=t&&(40<(this.history.length=this.position)&&(this.history.shift(),this.position--),this.position++,this.history.push(e))},undo:function(){this.transact(),1>=this.position||(this.set(this.history[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.position>=this.history.length||(this.set(this.history[++this.position-1]),this.editor.fire("redo:composer"))},set:function(t){this.composer.setValue(t),this.editor.focus(!0)}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(t,e,n){this.parent=t,this.element=e,this.config=n,this._observeViewChange()},_observeViewChange:function(){var t=this;this.parent.observe("beforeload",function(){t.parent.observe("change_view",function(e){e===t.name?(t.parent.currentView=t,t.show(),setTimeout(function(){t.focus()},0)):t.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(t){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(t){var e=t.dom,n=t.browser;t.views.Composer=t.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(t,e,n){this.base(t,e,n),this.textarea=this.parent.textarea,this._initSandbox()},clear:function(){this.element.innerHTML=n.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(e){var n=this.isEmpty()?"":t.quirks.getCorrectInnerHTML(this.element);return e&&(n=this.parent.parse(n)),n=t.lang.string(n).replace(t.INVISIBLE_SPACE).by("")},setValue:function(t,e){e&&(t=this.parent.parse(t)),this.element.innerHTML=t},show:function(){this.iframe.style.display=this._displayStyle||"",this.disable(),this.enable()},hide:function(){this._displayStyle=e.getStyle("display").from(this.iframe),"none"===this._displayStyle&&(this._displayStyle=null),this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable"),this.base()},enable:function(){this.element.setAttribute("contentEditable","true"),this.base()},focus:function(e){t.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var n=this.element.lastChild;e&&n&&("BR"===n.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return e.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var t=this.element.innerHTML;return""===t||t===this.CARET_HACK||this.hasPlaceholderSet()||""===this.getTextContent()&&!this.element.querySelector("blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea")},_initSandbox:function(){var t=this;this.sandbox=new e.Sandbox(function(){t._create()},{stylesheets:this.config.stylesheets}),this.iframe=this.sandbox.getIframe();var n=document.createElement("input");n.type="hidden",n.name="_wysihtml5_mode",n.value=1;var i=this.textarea.element;e.insert(this.iframe).after(i),e.insert(n).after(i)},_create:function(){var i=this;this.doc=this.sandbox.getDocument(),this.element=this.doc.body,this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0),this.enable(),this.selection=new t.Selection(this.parent),this.commands=new t.Commands(this.parent),e.copyAttributes("className spellcheck title lang dir accessKey".split(" ")).from(this.textarea.element).to(this.element),e.addClass(this.element,this.config.composerClassName),this.config.style&&this.style(),this.observe();var r=this.config.name;r&&(e.addClass(this.element,r),e.addClass(this.iframe,r)),(r="string"==typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder"))&&e.simulatePlaceholder(this.parent,this,r),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){i.focus()},100),t.quirks.insertLineBreakOnReturn(this),n.clearsContentEditableCorrectly()||t.quirks.ensureProperClearing(this),n.clearsListsInContentEditableCorrectly()||t.quirks.ensureProperClearingOfLists(this),this.initSync&&this.config.sync&&this.initSync(),this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var i=this,r=n.canDisableAutoLinking(),o=n.doesAutoLinkingInContentEditable();if(r&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!o||o&&r)&&this.parent.observe("newword:composer",function(){i.selection.executeAndRestore(function(t,n){e.autoLink(n.parentNode)})});var s=this.sandbox.getDocument().getElementsByTagName("a"),a=e.autoLink.URL_REG_EXP,l=function(n){return n=t.lang.string(e.getTextContent(n)).trim(),"www."===n.substr(0,4)&&(n="http://"+n),n};e.observe(this.element,"keydown",function(t){if(s.length){var n,t=i.selection.getSelectedNode(t.target.ownerDocument),r=e.getParentElement(t,{nodeName:"A"},4);r&&(n=l(r),setTimeout(function(){var t=l(r);t!==n&&t.match(a)&&r.setAttribute("href",t)},0))}})}},_initObjectResizing:function(){var i=["width","height"],r=i.length,o=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing),this.config.allowObjectResizing?n.supportsEvent("resizeend")&&e.observe(o,"resizeend",function(e){for(var n,e=e.target||e.srcElement,s=e.style,a=0;r>a;a++)n=i[a],s[n]&&(e.setAttribute(n,parseInt(s[n],10)),s[n]="");t.quirks.redraw(o)}):n.supportsEvent("resizestart")&&e.observe(o,"resizestart",function(t){t.preventDefault()})},_initUndoManager:function(){new t.UndoManager(this.parent)}})}(wysihtml5),function(t){var e=t.dom,n=document,i=window,r=n.createElement("div"),o="background-color color cursor font-family font-size font-style font-variant font-weight line-height letter-spacing text-align text-decoration text-indent text-rendering word-break word-wrap word-spacing".split(" "),s="background-color border-collapse border-bottom-color border-bottom-style border-bottom-width border-left-color border-left-style border-left-width border-right-color border-right-style border-right-width border-top-color border-top-style border-top-width clear display float margin-bottom margin-left margin-right margin-top outline-color outline-offset outline-width outline-style padding-left padding-right padding-top padding-bottom position top left right bottom z-index vertical-align text-align -webkit-box-sizing -moz-box-sizing -ms-box-sizing box-sizing -webkit-box-shadow -moz-box-shadow -ms-box-shadow box-shadow -webkit-border-top-right-radius -moz-border-radius-topright border-top-right-radius -webkit-border-bottom-right-radius -moz-border-radius-bottomright border-bottom-right-radius -webkit-border-bottom-left-radius -moz-border-radius-bottomleft border-bottom-left-radius -webkit-border-top-left-radius -moz-border-radius-topleft border-top-left-radius width height".split(" "),a="width height top left right bottom".split(" "),l=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",t.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],c=function(t){if(t.setActive)try{t.setActive()}catch(r){}else{var o=t.style,s=n.documentElement.scrollTop||n.body.scrollTop,a=n.documentElement.scrollLeft||n.body.scrollLeft,o={position:o.position,top:o.top,left:o.left,WebkitUserSelect:o.WebkitUserSelect};e.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(t),t.focus(),e.setStyles(o).on(t),i.scrollTo&&i.scrollTo(a,s)}};t.views.Composer.prototype.style=function(){var u=this,d=n.querySelector(":focus"),h=this.textarea.element,f=h.hasAttribute("placeholder"),p=f&&h.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||r.cloneNode(!1),this.blurStylesHost=this.blurStylesHost||r.cloneNode(!1),f&&h.removeAttribute("placeholder"),h===d&&h.blur(),e.copyStyles(s).from(h).to(this.iframe).andTo(this.blurStylesHost),e.copyStyles(o).from(h).to(this.element).andTo(this.blurStylesHost),e.insertCSS(l).into(this.element.ownerDocument),c(h),e.copyStyles(s).from(h).to(this.focusStylesHost),e.copyStyles(o).from(h).to(this.focusStylesHost);var m=t.lang.array(s).without(["display"]);if(d?d.focus():h.blur(),f&&h.setAttribute("placeholder",p),!t.browser.hasCurrentStyleProperty())var g=e.observe(i,"resize",function(){if(e.contains(document.documentElement,u.iframe)){var t=e.getStyle("display").from(h),n=e.getStyle("display").from(u.iframe);h.style.display="",u.iframe.style.display="none",e.copyStyles(a).from(h).to(u.iframe).andTo(u.focusStylesHost).andTo(u.blurStylesHost),u.iframe.style.display=n,h.style.display=t}else g.stop()});return this.parent.observe("focus:composer",function(){e.copyStyles(m).from(u.focusStylesHost).to(u.iframe),e.copyStyles(o).from(u.focusStylesHost).to(u.element)}),this.parent.observe("blur:composer",function(){e.copyStyles(m).from(u.blurStylesHost).to(u.iframe),e.copyStyles(o).from(u.blurStylesHost).to(u.element)}),this}}(wysihtml5),function(t){var e=t.dom,n=t.browser,i={66:"bold",73:"italic",85:"underline"};t.views.Composer.prototype.observe=function(){var r=this,o=this.getValue(),s=this.sandbox.getIframe(),a=this.element,l=n.supportsEventsInIframeCorrectly()?a:this.sandbox.getWindow(),c=n.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];e.observe(s,"DOMNodeRemoved",function(){clearInterval(u),r.parent.fire("destroy:composer")});var u=setInterval(function(){e.contains(document.documentElement,s)||(clearInterval(u),r.parent.fire("destroy:composer"))},250);e.observe(l,"focus",function(){r.parent.fire("focus").fire("focus:composer"),setTimeout(function(){o=r.getValue()},0)}),e.observe(l,"blur",function(){o!==r.getValue()&&r.parent.fire("change").fire("change:composer"),r.parent.fire("blur").fire("blur:composer")}),t.browser.isIos()&&e.observe(a,"blur",function(){var t=a.ownerDocument.createElement("input"),e=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollLeft||document.body.scrollLeft;try{r.selection.insertNode(t)}catch(i){a.appendChild(t)}t.focus(),t.parentNode.removeChild(t),window.scrollTo(n,e)}),e.observe(a,"dragenter",function(){r.parent.fire("unset_placeholder")}),n.firesOnDropOnlyWhenOnDragOverIsCancelled()&&e.observe(a,["dragover","dragenter"],function(t){t.preventDefault()}),e.observe(a,c,function(t){var e,i=t.dataTransfer;i&&n.supportsDataTransfer()&&(e=i.getData("text/html")||i.getData("text/plain")),e?(a.focus(),r.commands.exec("insertHTML",e),r.parent.fire("paste").fire("paste:composer"),t.stopPropagation(),t.preventDefault()):setTimeout(function(){r.parent.fire("paste").fire("paste:composer")
},0)}),e.observe(a,"keyup",function(e){e=e.keyCode,(e===t.SPACE_KEY||e===t.ENTER_KEY)&&r.parent.fire("newword:composer")}),this.parent.observe("paste:composer",function(){setTimeout(function(){r.parent.fire("newword:composer")},0)}),n.canSelectImagesInContentEditable()||e.observe(a,"mousedown",function(t){var e=t.target;"IMG"===e.nodeName&&(r.selection.selectNode(e),t.preventDefault())}),e.observe(a,"keydown",function(t){var e=i[t.keyCode];(t.ctrlKey||t.metaKey)&&!t.altKey&&e&&(r.commands.exec(e),t.preventDefault())}),e.observe(a,"keydown",function(e){var n=r.selection.getSelectedNode(!0),i=e.keyCode;!n||"IMG"!==n.nodeName||i!==t.BACKSPACE_KEY&&i!==t.DELETE_KEY||(i=n.parentNode,i.removeChild(n),"A"===i.nodeName&&!i.firstChild&&i.parentNode.removeChild(i),setTimeout(function(){t.quirks.redraw(a)},0),e.preventDefault())});var d={IMG:"Image: ",A:"Link: "};e.observe(a,"mouseover",function(t){var t=t.target,e=t.nodeName;!("A"!==e&&"IMG"!==e)&&!t.hasAttribute("title")&&(e=d[e]+(t.getAttribute("href")||t.getAttribute("src")),t.setAttribute("title",e))})}}(wysihtml5),function(t){t.views.Synchronizer=Base.extend({constructor:function(t,e,n){this.editor=t,this.textarea=e,this.composer=n,this._observe()},fromComposerToTextarea:function(e){this.textarea.setValue(t.lang.string(this.composer.getValue()).trim(),e)},fromTextareaToComposer:function(t){var e=this.textarea.getValue();e?this.composer.setValue(e,t):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(t){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(t):this.fromComposerToTextarea(t)},_observe:function(){var e,n=this,i=this.textarea.element.form,r=function(){e=setInterval(function(){n.fromComposerToTextarea()},400)},o=function(){clearInterval(e),e=null};r(),i&&(t.dom.observe(i,"submit",function(){n.sync(!0)}),t.dom.observe(i,"reset",function(){setTimeout(function(){n.fromTextareaToComposer()},0)})),this.editor.observe("change_view",function(t){"composer"!==t||e?"textarea"===t&&(n.fromComposerToTextarea(!0),o()):(n.fromTextareaToComposer(!0),r())}),this.editor.observe("destroy:composer",o)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(t,e,n){this.base(t,e,n),this._observe()},clear:function(){this.element.value=""},getValue:function(t){var e=this.isEmpty()?"":this.element.value;return t&&(e=this.parent.parse(e)),e},setValue:function(t,e){e&&(t=this.parent.parse(t)),this.element.value=t},hasPlaceholderSet:function(){var t=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),e=this.element.getAttribute("placeholder")||null,n=this.element.value;return t&&!n||n===e},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var t=this.element,e=this.parent,n={focusin:"focus",focusout:"blur"},i=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];e.observe("beforeload",function(){wysihtml5.dom.observe(t,i,function(t){t=n[t.type]||t.type,e.fire(t).fire(t+":textarea")}),wysihtml5.dom.observe(t,["paste","drop"],function(){setTimeout(function(){e.fire("paste").fire("paste:textarea")},0)})})}}),function(t){var e=t.dom;t.toolbar.Dialog=t.lang.Dispatcher.extend({constructor:function(t,e){this.link=t,this.container=e},_observe:function(){if(!this._observed){var n=this,i=function(t){var e=n._serialize();e==n.elementToChange?n.fire("edit",e):n.fire("save",e),n.hide(),t.preventDefault(),t.stopPropagation()};e.observe(n.link,"click",function(){e.hasClass(n.link,"wysihtml5-command-dialog-opened")&&setTimeout(function(){n.hide()},0)}),e.observe(this.container,"keydown",function(e){var r=e.keyCode;r===t.ENTER_KEY&&i(e),r===t.ESCAPE_KEY&&n.hide()}),e.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",i),e.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(t){n.fire("cancel"),n.hide(),t.preventDefault(),t.stopPropagation()});for(var r=this.container.querySelectorAll("input, select, textarea"),o=0,s=r.length,a=function(){clearInterval(n.interval)};s>o;o++)e.observe(r[o],"change",a);this._observed=!0}},_serialize:function(){for(var t=this.elementToChange||{},e=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),n=e.length,i=0;n>i;i++)t[e[i].getAttribute("data-wysihtml5-dialog-field")]=e[i].value;return t},_interpolate:function(t){for(var e,n,i=document.querySelector(":focus"),r=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),o=r.length,s=0;o>s;s++)e=r[s],e!==i&&!(t&&"hidden"===e.type)&&(n=e.getAttribute("data-wysihtml5-dialog-field"),n=this.elementToChange?this.elementToChange[n]||"":e.defaultValue,e.value=n)},show:function(t){var n=this,i=this.container.querySelector("input, select, textarea");if(this.elementToChange=t,this._observe(),this._interpolate(),t&&(this.interval=setInterval(function(){n._interpolate(!0)},500)),e.addClass(this.link,"wysihtml5-command-dialog-opened"),this.container.style.display="",this.fire("show"),i&&!t)try{i.focus()}catch(r){}},hide:function(){clearInterval(this.interval),this.elementToChange=null,e.removeClass(this.link,"wysihtml5-command-dialog-opened"),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(t){var e=t.dom,n={position:"relative"},i={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},r={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},o={"x-webkit-speech":"",speech:""};t.toolbar.Speech=function(s,a){var l=document.createElement("input");if(t.browser.supportsSpeechApiOn(l)){var c=document.createElement("div");t.lang.object(i).merge({width:a.offsetWidth+"px",height:a.offsetHeight+"px"}),e.insert(l).into(c),e.insert(c).into(a),e.setStyles(r).on(l),e.setAttributes(o).on(l),e.setStyles(i).on(c),e.setStyles(n).on(a),e.observe(l,"onwebkitspeechchange"in l?"webkitspeechchange":"speechchange",function(){s.execCommand("insertText",l.value),l.value=""}),e.observe(l,"click",function(t){e.hasClass(a,"wysihtml5-command-disabled")&&t.preventDefault(),t.stopPropagation()})}else a.style.display="none"}}(wysihtml5),function(t){var e=t.dom;t.toolbar.Toolbar=Base.extend({constructor:function(e,n){this.editor=e,this.container="string"==typeof n?document.getElementById(n):n,this.composer=e.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),this.show();for(var i=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),r=i.length,o=0;r>o;o++)new t.toolbar.Speech(this,i[o])},_getLinks:function(e){for(var n,i,r,o,s,a=this[e+"Links"]=t.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+e+"]")).get(),l=a.length,c=0,u=this[e+"Mapping"]={};l>c;c++)n=a[c],r=n.getAttribute("data-wysihtml5-"+e),o=n.getAttribute("data-wysihtml5-"+e+"-value"),i=this.container.querySelector("[data-wysihtml5-"+e+"-group='"+r+"']"),s=this._getDialog(n,r),u[r+":"+o]={link:n,group:i,name:r,value:o,dialog:s,state:!1}},_getDialog:function(e,n){var i,r,o=this,s=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']");return s&&(i=new t.toolbar.Dialog(e,s),i.observe("show",function(){r=o.composer.selection.getBookmark(),o.editor.fire("show:dialog",{command:n,dialogContainer:s,commandLink:e})}),i.observe("save",function(t){r&&o.composer.selection.setBookmark(r),o._execCommand(n,t),o.editor.fire("save:dialog",{command:n,dialogContainer:s,commandLink:e})}),i.observe("cancel",function(){o.editor.focus(!1),o.editor.fire("cancel:dialog",{command:n,dialogContainer:s,commandLink:e})})),i},execCommand:function(t,e){if(!this.commandsDisabled){var n=this.commandMapping[t+":"+e];n&&n.dialog&&!n.state?n.dialog.show():this._execCommand(t,e)}},_execCommand:function(t,e){this.editor.focus(!1),this.composer.commands.exec(t,e),this._updateLinkStates()},execAction:function(t){var e=this.editor;switch(t){case"change_view":e.currentView===e.textarea?e.fire("change_view","composer"):e.fire("change_view","textarea")}},_observe:function(){for(var t=this,n=this.editor,i=this.container,r=this.commandLinks.concat(this.actionLinks),o=r.length,s=0;o>s;s++)e.setAttributes({href:"javascript:;",unselectable:"on"}).on(r[s]);e.delegate(i,"[data-wysihtml5-command]","mousedown",function(t){t.preventDefault()}),e.delegate(i,"[data-wysihtml5-command]","click",function(e){var n=this.getAttribute("data-wysihtml5-command"),i=this.getAttribute("data-wysihtml5-command-value");t.execCommand(n,i),e.preventDefault()}),e.delegate(i,"[data-wysihtml5-action]","click",function(e){var n=this.getAttribute("data-wysihtml5-action");t.execAction(n),e.preventDefault()}),n.observe("focus:composer",function(){t.bookmark=null,clearInterval(t.interval),t.interval=setInterval(function(){t._updateLinkStates()},500)}),n.observe("blur:composer",function(){clearInterval(t.interval)}),n.observe("destroy:composer",function(){clearInterval(t.interval)}),n.observe("change_view",function(n){setTimeout(function(){t.commandsDisabled="composer"!==n,t._updateLinkStates(),t.commandsDisabled?e.addClass(i,"wysihtml5-commands-disabled"):e.removeClass(i,"wysihtml5-commands-disabled")},0)})},_updateLinkStates:function(){var n,i,r,o=this.commandMapping,s=this.actionMapping;for(n in o)r=o[n],this.commandsDisabled?(i=!1,e.removeClass(r.link,"wysihtml5-command-active"),r.group&&e.removeClass(r.group,"wysihtml5-command-active"),r.dialog&&r.dialog.hide()):(i=this.composer.commands.state(r.name,r.value),t.lang.object(i).isArray()&&(i=1===i.length?i[0]:!0),e.removeClass(r.link,"wysihtml5-command-disabled"),r.group&&e.removeClass(r.group,"wysihtml5-command-disabled")),r.state!==i&&((r.state=i)?(e.addClass(r.link,"wysihtml5-command-active"),r.group&&e.addClass(r.group,"wysihtml5-command-active"),r.dialog&&("object"==typeof i?r.dialog.show(i):r.dialog.hide())):(e.removeClass(r.link,"wysihtml5-command-active"),r.group&&e.removeClass(r.group,"wysihtml5-command-active"),r.dialog&&r.dialog.hide()));for(n in s)o=s[n],"change_view"===o.name&&(o.state=this.editor.currentView===this.editor.textarea,o.state?e.addClass(o.link,"wysihtml5-action-active"):e.removeClass(o.link,"wysihtml5-action-active"))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(t){var e={name:void 0,style:!0,toolbar:void 0,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:t.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:void 0,allowObjectResizing:!0,supportTouchDevices:!0};t.Editor=t.lang.Dispatcher.extend({constructor:function(n,i){if(this.textareaElement="string"==typeof n?document.getElementById(n):n,this.config=t.lang.object({}).merge(e).merge(i).get(),this.currentView=this.textarea=new t.views.Textarea(this,this.textareaElement,this.config),this._isCompatible=t.browser.supported(),!this._isCompatible||!this.config.supportTouchDevices&&t.browser.isTouchDevice()){var r=this;setTimeout(function(){r.fire("beforeload").fire("load")},0)}else{t.dom.addClass(document.body,this.config.bodyClassName),this.currentView=this.composer=new t.views.Composer(this,this.textareaElement,this.config),"function"==typeof this.config.parser&&this._initParser(),this.observe("beforeload",function(){this.synchronizer=new t.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new t.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(o){}}},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(t){return this.currentView.getValue(t)},setValue:function(t,e){return t?(this.currentView.setValue(t,e),this):this.clear()},focus:function(t){return this.currentView.focus(t),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(e){var n=this.config.parser(e,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return"object"==typeof e&&t.quirks.redraw(e),n},_initParser:function(){this.observe("paste:composer",function(){var e=this;e.composer.selection.executeAndRestore(function(){t.quirks.cleanPastedHTML(e.composer.element),e.parse(e.composer.element)},!0)}),this.observe("paste:textarea",function(){this.textarea.setValue(this.parse(this.textarea.getValue()))})}})}(wysihtml5);